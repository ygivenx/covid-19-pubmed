{"title": "Impact of the topology of metapopulations on the resurgence of epidemics rendered by a new multiscale hybrid modeling approach", "body": "The vast majority of epidemic models described so far are compartmental, meaning that individuals are classified and grouped depending on their health status (Anderson and May, 1991; Bailey, 1975; Kermack and McKendrick, 1927) . A famous example in ecology is the model of fox rabies in Europe (Anderson and May, 1979) . This class of models presents the advantage of manipulating proportions of a same population and not having to deal with individualities. This line of reasoning has proven to be very efficient, especially from a mathematical and computational point of view, as models taking account of individual heterogeneities pose tractability problems for large populations and can be hard to analyze. Nevertheless, an insidious corollary of the compartmental approach has been the assumption that the population under consideration is well-mixed. Even if this sounds reasonable to describe small local populations, the broadening of this property to the metapopulation scale seems hazardous. In populations of wild animals as well as in human societies, individuals are generally grouped in high-density sites (i.e. cities, farms, and forest patches) separated spatially by large zones from which they are absent or present in negligible density only. Between these sites, elements of the landscape strongly affect the intensity at which individuals from different sites can interact (Real and Biek, 2007) . The number of contacts each individual has is usually considerably smaller than the metapopulation size (Keeling and Eames, 2005) . Therefore, the idea of a metapopulation-wide random-mixing of individuals does not seem to stand. While the variations of compartmental models have been overly studied (Hethcote, 1995) , little attention has been paid to the correctness of the postulates on which this class of models relies.\n\nIn this paper, we detail a generic model that can be used to represent dynamic processes like epizootics in a spatially-explicit way, thereby lifting the need for the well-mixed assumption at the metapopulation scale, and without relinquishing the simplicity offered by the compartmental approach. Our solution relies on an approach offering great flexibility to model complex multiscale systems by uniting System Dynamics (SD) (Ford, 1999; Forrester, 1971) and Individual-Based Modeling (IBM) (Grimm and Railsback, 2005) . The philosophy and framework supporting this technique is referred to as System Dynamics-Individual-Based (SD-IB) hybrid modeling (Vincenot et al., 2011) and represents a novel modeling paradigm unused so far in ecology to our knowledge. Compartmental models are probably the most efficient way to simulate the dynamics of an epidemic as long as the well-mixed assumption is met (Fig. 2, top) . System Dynamics is a very advantageous technique to build such models, because it is based on an ordinary differential equation (ODE) solver and features stock-and-flow display, which is capable of great analytical power through its related tools (e.g. causal loop diagrams). Furthermore, it makes the model's structure easier and more straightforward to understand than raw differential equations. On the other hand, Individual-Based Modeling (IBM), technically originating from Agent-Based Modeling (ABM), is inherently capable of representing network structures in a spatially-explicit way making it possible to take into account distances between sites. In addition, it can handle large numbers of sites in a more efficient way than SD (Fig. 2, bottom) . Thus, it is a perfect candidate to simulate the global spread of a disease in a network-like structure. These considerations motivated the use of an SD-IB hybrid model to reproduce the contagion mechanisms in an accurate, understandable, and tractable manner.\n\nWe start by describing the design of our hybrid model of epizootics in population networks. Then we show through simulations how it can render characteristic behaviors of large-scale epidemics, which are generally absent from compartmental models. Afterwards, we discuss the significance and implications of these results as well as the pertinence of the solution proposed here.\n\nWe follow hereafter the updated 7-points Overview-Design concepts-Details (ODD) standard protocol formulated by Grimm et al. (2006 Grimm et al. ( , 2010 for describing individual-based models.\n\nThe purpose of this model is to simulate the dynamics of disease contagion in very large fragmented populations at both the local and global scales. Here, we use this model to study the impact of network topology on the global evolution of epidemics.\n\nThis model is based on a geographic breakdown of metapopulations, and features a single entity called site. Each site actually equals to one population and is basically defined by three state variables (represented as stocks in the System Dynamics submodel) dividing the local population into classes of susceptible (S), infected (I), and recovered (R) individuals. On top of these, two more state variables keep track of ongoing emigration and immigration of infectious individuals. Each site is also characterized by its unique two-dimensional spatial coordinates set at initialization time and invariant thereafter. Fundamentally, the model integrates disease dynamics at two spatial scales, namely inside of sites (local outbreaks) and between sites (global epidemics). For this purpose, connections between neighboring sites are also taken into account. A neighboring site is defined as any site closer than a threshold distance given by the neighborhood range parameter. The simulations, running in steps of one week, are meant to reproduce disease propagation inside of a 500 \u00d7 500 km study area in a time frame of several months to years after its introduction.\n\nTwo processes take place in the following order inside of the model: the rendering of local outbreak dynamics in each site, and the migrations of infectious individuals between sites. Variables are updated synchronously inside of each process. The global model runs in hybrid time with local outbreaks calculated in continuous time, and the migrations happening as discrete events. Note that an integration step (\u0394t) of 0.01 week was used to compute the results reported in this study.\n\n2.1.4. Design concepts 2.1.4.1. Basic principles. First, the model is built on the assumption that network structures, extensively studied in social sciences and graph theory, play an important role in the understanding of epidemiological processes (Keeling and Eames, 2005 , and references therein). Indeed, large-scale epidemical outbreaks occur between several sites on which individuals are present in high density. At the metapopulation scale, a disease spreads when it is transferred by infected individuals (or third-party vectors) from site to site. As a result, each site can be regarded as the node of a large network.\n\nSecond, an underlying idea supporting this model is that epidemics take place concurrently at two different scales: local (inside of each site/node) and global (between sites/nodes inside of the network). The bond between these two dimensions is manifest in spatially-explicit observational datasets (Fig. 1) . That is why the goal of the hybrid model presented here was to offer the possibility to simulate accurately disease transmission at both levels.\n\n2.1.4.2. Emergence. The dynamics of the global epidemics emerge from the interactions of concurrent local outbreaks. As such, the dynamics of local outbreaks are primarily dependent on epidemiological parameters especially during the first epidemic wave, whereas the global epidemic arises entirely from the interaction of concurrent outbreaks. , is the main data sampled for observation. In one experiment (Fig. 6) , the immigration and infection processes (i.e. in SD terminology, the inflows to stock I) are observed jointly with the evolution of the number of infected individuals (I).\n\nAt initialization, sites are set to be organized in random spatial layouts, except in the experiment related in Fig. 4 in which sites are filling the available space by being placed at a regular interval from their neighbors (i.e. the so-called \"arranged\" or \"regular\" layout). The spatial arrangement changes neither at runtime nor between runs of the same experiment. Links between sites are automatically established by the framework for sites lying within their neighborhood range (i.e. 150 km, except in the experiment related in Fig. 4) . Also, at the beginning of the simulation, inside of each site, the entire population is concentrated in the susceptible (S) state variable and no infectious individual exists. The first infection is triggered manually at runtime. Parameter values used in the hybrid model and their sources are given in Table 1 .\n\nThe hybrid model can reproduce the two-scale dynamics of an epidemic outbreak inside of a metapopulation structured in a network of sites by merging an IBM submodel and an SD submodel (Fig. 3) . Their description is given hereafter.\n\n2.1.6.1. Local outbreaks computation (SD). We assert that each site contains a closed and homogeneously mixed population. Hence, a classic SIRS epidemic model with delayed recovery is used to model the dynamics of outbreaks inside of sites. The content of this type of compartmental model has been described extensively in the literature (Anderson and May, 1979; Hethcote et al., 1981) and has been used to study diseases involving potential recovery which confers temporary immunity (e.g. Orthomyxoviridae causing the seasonal flu). It features three compartments representing generic infection stages of individuals in a population: susceptible (S), infected (I), and recovered (R). The epidemic's dynamics is then described as processes moving numbers of individuals between these compartments. Several rates dictate the transfer from one class to another, like the effective contact rate \u03b2 from S to I, the recovery rate \u03c5 from I to R, and the immunity loss rate d r \u2212 1 from R to S. Following the results of de Jong et al. (1995) , we prefer basing the infection process on the true mass-action assumption, with a transmission term dependent on the size of the population. We keep the model as simple as possible by considering a constant population size. This way, the effects of disease dynamics are wellknown in advance and their role in results obtained during later runs of the hybrid model at the metapopulation scale can be isolated from concurrent exogenous phenomena. Finally, the non-linear system can be expressed as a set of differential equations.\n\nEq.\n\n(1) shows the compartmental SIRS model. This compartmental model is translated into System Dynamics in the hybrid model. In SD terminology, each class of individuals (i.e. All strains are shown here, although influenza A (H1) accounts for the vast majority of the infections (at the very least 75% of the reports in any week during the period of interest). (B1-B8) Spatial distribution of the disease in the prefectures of Japan. The strength of the epidemic is represented by colors ranging from white to orange for inexistent to mild epidemic status, and rosa to red for strong disease prevalence. The disease erupts in Hokkaido (northernmost island of Japan) (B1week 45) and spreads throughout most of the country with the number of infected individuals reaching a first peak (B2week 51). Shortly after, following a decrease in intensity in Hokkaido in the 52nd week, the epidemic drops off (B3week 1). After an intensification of the disease on the other islands, the epidemic bounces back in a stronger second wave and propagates throughout all the prefectures (B4week 4). While the disease is in recession on Hokkaido, the global epidemic starts to decline (B5week 5). A short-lived outbreak in Hokkaido generates a minor peak (B6/B7weeks 7-8). Finally, the epidemic fades away and puts an end to this episode (B8week 10). (For interpretation of the references to color in this figure legend, the reader is referred to the web version of this article.) Source: Compiled from archive data of the Infectious Agents Surveillance Report (IASR) published by the Infectious Disease Surveillance Center (IDSC), National Institute of Infectious Diseases, Japan.\n\nsusceptible, infected and recovered) is symbolized by stocks, while the processes moving numbers of individuals between them (i.e. infection, recovery, and immunity loss) correspond to flows linking together the previous stocks. To verify the previous equations and reconstruct an SIRS model similar to what was already studied in the literature (Hethcote et al., 1981) , the \"recovery\" flow is set to delay its inflow by a given time period (i.e. the duration of infectiousness) to form what is often referred to as \"conveyor\" in the SD literature. It should be noted that we deliberately do not consider infinitesimal numbers of remaining individual in the infected compartment (I). A minimum value (floor) under which the number of infected individuals is considered as zero is fixed. The reason for this is clarified in Section 4.1.1.\n\n2.1.6.2. Migrations inside of the metapopulation (IBM). The number of emigrants is calculated based on the number of infected individuals and the emigration rate. A transfer function then practically performs a weighted distribution of these infected migrants to neighboring sites using the pre-established connections. The weights are chosen to be proportional to the relative proximity of each neighbor from the current site (Eq. (2)). This function is called for each site agent in a periodic way at each time-step of the simulation engine. Here too, we chose not to realize transfers of fractions of an individual.\n\nEq.\n\n(2) shows the weighted distribution function used to calculate the number of infected individuals to be dispatched from a site S a to a site S b at time t. This function is distance-based and is iterated on S b to distribute all the emigrants (r emigration \u00d7 I Sa t \u00f0 \u00de with r emigration being the emigration rate and I Sa t \u00f0 \u00de the number of infected individuals present on the site S a at time t) to the site's neighbors proportionally to their remoteness dist S a ; S b \u00f0 \u00de \u00f0 \u00de .\n\n2.1.6.3. Practical implementation and fusion of the SD and IBM submodels. We chose xjTek's AnyLogic 6.4.1, an Eclipse-based development environment, to implement both submodels. Since this framework is object-oriented and relies entirely on Sun's Java Virtual Machine (JVM), the SD and IB model components could be integrated as Java classes. As a consequence, interactions between SD components and IB agents could be translated as algorithms performing data exchanges between objects. This offered an opportunity to bridge the SD model with IBM agents in a simple yet flexible manner, and this inside of a single program. Conceptually, the SD model was virtually embedded inside of the class of agents representing sites. Technically, this meant that for each instance of the \"site\" class, an internal reference to a new instance of our SD model was created. Moreover, to facilitate the interaction between each agent and its assigned SD model instance, we included in the structure of the template SD model two stocksan immigration stock and an emigration stockwith which the agent's algorithmic rules could programmatically interact to perform the migration of infected individuals between sites. In short, a dedicated rule was written in the site agent class to retrieve the information of the emigration stock of the current site agent and, following the weighted distribution function (Eq. (2)), dispatch the infected individuals in the form of increments of the neighboring sites' immigration stocks.\n\nThe model was run to simulate the spread of a contagious disease in a metapopulation under various conditions. First, taking the same epidemiological parameters for every population, the SD-IB hybrid model was executed with different types of distribution of the metapopulation. Three main scenarios were then tested:\n\nScenario A The metapopulation is distributed in a regular and fullyconnected network (i.e. sites are uniformly distributed and each of them is connected to every other site of the network). Scenario B The metapopulation is distributed in a random layout in which the distance between neighboring sites is highly variable and impacts the connectivity of the network, but each population has strictly the same size. Scenario C The metapopulation is distributed in a fixed layout, and the population's size is allowed to vary between sites.\n\nIterative runs with conditions ranging from scenario A towards a reduction of the network connectivity were also performed. Note that, in this paper, \"network connectivity\" stands for a metric defined as the percentage of the total network that sites have within their neighborhood range in average (i.e. the share of the network they are connected to). For example, in a network of 11 sites, if in average each site is connected to 5 other sites, the network connectivity equals 50%. As already mentioned, a \"neighborhood range\" parameter controlled the distance under which sites were considered as neighbors, and indirectly allowed in the scope of this experiment to produce metapopulations with different values of network connectivity.\n\nThe result of each run was qualitatively compared with predictions from a classic compartmental model based on the well-mixed assumption. For each experiment, the latter model, based on Eq. (1), was initialized with exactly the same epidemiological parameters as the ones used for the simulation of local outbreaks in the hybrid model, and the susceptible compartment (S) was set to a value equivalent to the size of the entire metapopulation (refer to Table 1 for exact values).\n\nIn a second step, while sticking to a fixed network layout and equal population size for every population, sensitivity analysis (S.A.) was performed on epidemiological and spatial parameters (contact rate, immunity loss rate, starting point of the epidemic, and emigration rate) to evaluate their impact on the epidemic's development. Different sets of values were chosen and the model was run sequentially with each of them to determine the joint effects of parameter changes. The ranges used for this sensitivity analysis are reported in the comments of Table 1 . Additionally, to evaluate the impact of dynamic variations during the epidemic (resulting from prophylactic measures for example), the values of some of these parameters (contact rate and emigration rate) were also varied manually at runtime through the model's graphical control interface.\n\nIn scenario A, the evolution of the prevalence output by the hybrid model was very close to the prediction made by a classic SIRS model, which considers the metapopulation as well-mixed. With a gradual lessening of the network connectivity, however, the discrepancies with this model worsened (Fig. 4) .\n\nIn scenario B, the previous tendency was accentuated. Here, the hybrid model displayed complex dynamics. The delay introduced by the spread between sites considerably influenced the global evolution of the outbreak. On top of introducing an obvious lag in the spread of the epidemic, it also reduced the spot prevalence of the disease in the metapopulation during the whole length of the experiments. The force of infection f = \u03b2I = S + I + R \u00f0 \u00dewas also proportionally impacted. Moreover, the shape described by the evolution of the overall infected population showed great variability, as opposed to the regular peak produced by traditional compartmental models. Several peaks of different amplitudes could be visible during a single episode (Fig. 5,  top) . More importantly, the epidemic exhibited a risk of installing itself and becoming resurgent (Fig. 5, bottom) . The model showed that the location of the starting point of the outbreak was an important parameter conditioning the appearance of such a behavior (Fig. 7) .\n\nThe last scenario (C) was mainly aimed at testing the effect of heterogeneity in demographic parameters (here, population size) on the epidemic spread. Therefore, the network topology stayed fixed while the populations varied in size between sites. Fundamentally, the output of this model was comparable to what was obtained for scenario B. Furthermore, we observed that variations of population size on a single site could alter the geographic propagation path of the disease (Fig. 8) . Seen on a global scale, this resulted in different possible developments of the epidemic, which could reach all sites in a single burst (Fig. 8, top) , be impaired in its progression (Fig. 8,  middle) , or even come to a sudden end (Fig. 8, bottom) depending on the size of the population attributed to the site.\n\nGlobally, the network topology as well as the starting point of the outbreak proved to be very important parameters influencing the duration, amplitude, shape and resurgence in these scenarios. Fig. 5 . Prediction of the traditional compartmental model versus typical runs of our hybrid model with the same parameters. The latter, thanks to its capacity to explicitly represent the epidemic network, produces episodes featuring a longer duration, lower instantaneous prevalence, and complex dynamics with multiple peaks (upper half). What is more, rendered without the well-mixed assumption, the epidemics show a tendency to bounce back and engender several episodes (lower half). Note that simulations of an outbreak in an isolated site using the traditional compartmental model would only return a single peak and no resurgent behavior.\n\nWhen varying the transient immunity duration, we could observe that the higher the value of the latter was, the lower the number of sites that could give birth to a resurgent epidemic was. This parameter interacted in a highly sensitive way with the network topology. For example, on a given fixed layout with 29 connected sites, we obtained that with d r = 29 weeks, all the sites were potential starting points for resurgent epidemics, whereas with d r = 30weeks and d r = 31 weeks, their numbers were reduced to 22 and 3 respectively, translating into a global risk of resurgence of 0.75 and 0.10 respectively.\n\nThe effects of varying the migration rate were also investigated. High migration rates (superior to 0.25) lead to a dampening of the periodic oscillations generated by the epidemic episodes. In such cases, ultimately, we observed a convergence to a stable equilibrium. Another experiment involved simulating the effect of \"cutting off\" migrations inside of the metapopulation once a resurgent epidemic is installed. This resulted in a strong decrease of the global prevalence over the following months, with lower peaks than before, and an apparent eradication of the disease generally after less than 3 years. However, at this point, although only a negligible fraction of infected individuals were left (b0.005% of the total population), allowing migrations again in the following months was enough to generate a violent epidemic resilience. Further results arose from studying the effect of dynamically modifying the contact rate of the disease. First, we could notice that an epidemic requires a lower contact rate to survive than to initially spread. For example, launching a successful epidemic required a contact rate of 1.335 while a minimum of 1.207 was enough to maintain it (given that the decrease didn't take place abruptly but progressively). In another experiment, we compared the decrease in transmissibility (i.e. contact rate) needed to break a stable epidemic with different migration rates. We observed that the higher the migration rate was, the more the epidemic was resistant to lower disease transmissibility. For instance, always on the same map, with a migration rate of 0.14, the epidemic could survive to a contact rate of 1.10, whereas with a migration rate of 0.01 the epidemic died off if the transmissibility dropped under 1.207. This apparent interference between demographic movements and epidemiological processes suggests the higher efficacy of synergistic containment initiatives. Finally, we also monitored a peculiar and counterintuitive behavior when the critical contact rate at which the epidemic is not viable anymore was reached. Before the abrupt disappearance of the epidemic, the peaks started growing more and more in amplitude while their frequency decreased.\n\nOn top of the importance of the outbreak's origin on the epidemic's success, we could observe that network topology itself was an essential factor that could influence whether or not a disease would spread. Indeed, taking the same epidemiological parameters, model runs with several different distributions of the metapopulation returned totally different results, some of them exhibiting largescale resurgent epidemics, others a single fleeting and weak outbreak.\n\nAn explanation for the appearance of this phenomenon lies in the fact that, unlike traditional compartmental models, the hybrid model could reckon with spatio-temporal waves and geographically isolated pockets, which could serve as sparks to reignite a new episode. A closer look at the starting point of a resurgent epidemic episode showed that a small number of remaining infected individuals traveling in waves across the network and converging to a same site were the trigger of new episodes (Fig. 6) .\n\nThe dramatic resurgent behavior of the epidemics exhibited by many of the hybrid model's runs reproduces behaviors that have often been reported in real outbreaks (Gubler, 2002; Raga et al., 2008; Riley et al., 2003) and completes previous observations made using different methodologies (Vazquez, 2007; Watts et al., 2005) .\n\nAlso, even if this paper was not aiming to provide a full insight on the impact of network topology on the evolution of outbreaks, results from our model reveal the critical importance of this factor, which proved to be able to strongly modulate almost all the aspects of disease contagion (amplitude and number of epidemic peaks, cumulative incidence, duration of the outbreak, number of episodes, etc.). For instance, the hybrid model predicted that an epidemic 7 . Impact of the location of the epidemic's starting point on its evolution. A local outbreak was started on two different sites in separate simulations. The results of the evolution of the large scale epidemic are represented in the chart. In one case, after a dense and long episode with average prevalence, the disease dies off. In the second run, even though the epidemic peaks at high prevalence and seems to disappear very fast, several other episodes eventually follow, exhibiting globally a resurgent behavior. episode could die-off if occurring in a network featuring a site carrying a smaller population entrapped in a bottleneck (Fig. 8, bottom) . Moreover, as exposed in Section 3.2, spatial parameters could interact with epidemiological parameters in a synergistic or destructive way, with metapopulation-scale properties either exacerbating or balancing the contagion mechanism. This variability of epidemics depending on network topology has been constantly exhibited by our model, and proves that metapopulation structure is a factor of control important to integrate in the prophylaxis of transmissible diseases. On this aspect, the experiment simulating a suppression of migrations (Section 3.2) particularly underlined the usefulness of being able to restrain spatial processes and parameters but also the risk of relaxing policies before the total control of the epidemic. Besides, the results presented in Fig. 7, Fig. 8 , and Section 3.2 also imply that all sites are not equal in importance, and as a consequence targeted policies on selected sites can have a far greater effect than metapopulation-wide measures. This is in accordance with conclusions from previous individual-based stochastic simulations of the worldwide spread of the severe acute respiratory syndrome (SARS) (Hufnagel et al., 2004) and of the spread of foot-and-mouth disease virus (FMDV) at a regional scale (Keeling et al., 2003) .\n\nIt is important to note that standard compartmental models based on a homogeneous representation of the metapopulation rely solely on the positive feedback loop responsible for the amplification of the infection process to generate cyclic episodes. In some cases, it has been observed that for this purpose, they end up computing infinitesimal values for the number of individuals remaining in the infected stock (I). The correctness of this calculation is doubtful and can be risky (Bartlett, 1957) . On the contrary, here, thanks to the mechanism revealed previously (Fig. 6 ), the hybrid model could produce such oscillatory behavior without considering fractions of remaining individuals for the number of infected and the number of migrating individuals. Accordingly, we can say that the network topology itself possesses the intrinsic capacity to make epidemics resurgent and can explain alone such phenomenon.\n\nIt should be noted that the previous findings are emerging properties of the structure of the metapopulation network only and are not characteristic of the precise type of compartmental epidemic model used here to simulate outbreaks. Some results were confirmed by replacing the SIRS model by a classic SIR model with vital dynamics (i.e. featuring a logistic population increasing up to a carrying capacity and independent death rates for I and R) (Vincenot and Moriya, 2009) . Besides this, unlike in previous metapopulation models (e.g. Watts et al. (2005) ), the real-life phenomena discussed earlier could be reproduced without resorting to any form of stochasticity.\n\nSome anterior works have sought to explain the multiple peaks observed in many epidemics by rendering the cross-protection between strains (Lavenu et al., 2004) . This hypothesis is certainly satisfying in many cases, but it cannot always explain the dynamics observed for influenza outbreaks. For instance, in the data presented in Fig. 1 , two main peaks are visible while no interaction between strains could be identified as the episode was driven by the single AH1 strain. At such a large scale, metapopulation structure can offer an explanation for such phenomenon as illustrated in the simulation of Fig. 5 (top) for example.\n\nSplitting the metapopulation in several distant spots was enough to engender complex spatial dynamics, which would be very difficult or impossible to reproduce with aggregated models. The evolution of the epidemic proved to be a function of the distribution of the populations depending on their distance from the starting point. The notion of distance between sites (hosting populations) and starting point of epidemics are obviously not integrated in models that consider the metapopulation as a single well-mixed entity. This deficiency was clearly visible here (Fig. 4) and it was exacerbated when considering local population size variability (as demonstrated with scenario C).\n\nA further divergence exposed by scenario C happened with the threshold over which the disease spreads. Compartmental models generally use the basic reproduction number R 0 as metric for this purpose. As expected, this was still verified on the local scale in the hybrid model; if R 0 N 1 was true for a given site, the disease could break out inside of this population. Nonetheless, as opposed to what models Fig. 8 . Effect of local population size variations on the evolution of an epidemic. An outbreak is started on the most upper-right site of the network. The propagation of the outbreak is evaluated depending on the size of the population located on the circled site: original size (i.e. 5000 individuals) (top), 50% (middle) and 20% (bottom) of the original size. In the first case, the outbreak spreads to the whole network through both paths A and B, whereas in the second case, it is too weak to transmit the disease through path A. In the last case, the small population size combined with the topology of the network causes the epidemic to die off. based on the well-mixed assumption would predict, this did not assure that the disease would spread successfully throughout the metapopulation. A second threshold appeared at the metapopulation scale. At this level, the spread of the disease was also conditioned by the migrations of individuals between sites. The combination of population size and connectivity of each site determined the number of infected individuals it would distribute to its neighbors. As a consequence, it was possible for a site not to get enough migrants to ignite a local outbreak, owing to the limited size or particular connectivity of his neighbors or both. Logically, except the starting point, any site for which \u2204t\u2211 Sn neighbors Scurrent \u00f0 \u00de T S n ; S current ; t \u00f0 \u00de \u22651 would surely not act as a relay for the outbreak. This could impact the spread of the disease, and, depending on the position of the site in the network topology, even bring an end to the epidemic (Fig. 8) . It is safe to assume that this phenomenon would be amplified in more realistic models including stochastic mortality during migrations, an explicit lag proportional to travel duration, or migration strengths depending on the actual connectivity between sites. This limited capacity of R 0 to judge from the chance of an outbreak to turn into an epidemic in this hybrid model supports the results obtained by Watts et al. (2005) with a stochastic individual-centered model, and fuels the surfacing debate on the disputable value of this metric to predict the outcome of largescale epidemics (Larson, 2007) .\n\nFrom the previous observations, we can stress that the use of compartmental models to represent epidemics in a population will inevitably be flawed if the population does not meet strictly the conditions of random-mixing. By definition, the latter assumption is rarely verified for metapopulations. This leads us to the conclusion that traditional aggregated models should be avoided when possible or should only be used with extreme care to simulate processes taking place inside of metapopulations such as large-scale epidemics. This corroborates results obtained about the detrimental effects of the well-mixed assumption in other fields (Beauchemin, 2006) .\n\nThe hybrid model presented here can be seen as an incarnation of Bailey's (1975) view of large-scale epidemics as metapopulation-scale phenomena emerging from the transport of individuals between interconnected subpopulations subject to concurrent disease outbreaks (as visible in Fig. 1 ). To render this multiscale nature of epidemics, our solution had a simple structure composed of two interacting layers (network of IBM agents, and at lower level, SD models). Its design was quick and straightforward considering the respective capabilities of the SD and IBM paradigms. Moreover, the sole creation of templates of an IBM agent class (for sites) and an SD submodel (for local outbreak dynamics) was needed, leaving all the instantiation, inter-agent linkage and distance calculation work to the framework. Consequently, further modifications, even dealing with local heterogeneities, were easy to perform thanks to the good structuring made possible by this hybrid system. At runtime, owing to the complete fusion of the IBM and SD models inside of the JVM, full feedback became available from both approaches. As a consequence, all the processes taking part in the epidemic's dynamics could be exposed in real-time for analysis (as visible in Fig. 3 ). The spread in the metapopulation was visible at the IBM level through a gradient change of color of the clouds representing sites depending on their epidemic stage as well as the display of the disease prevalence on each of them, while the real-time dynamics of the local outbreaks could be queried and displayed in SD form for any site selected. On top of this, stock-and-flow display was a convenient and accessible way to describe and show in real-time the local epidemic processes. It proved to be much easier and quicker to handle than differential equations or algorithmic rules. In this aspect, it enhanced considerably the understandability and communicability of the model, while making it easier to analyze.\n\nFrom a technical point of view, so far, two major modeling techniques have been in use to build metapopulation models: Individual-Based Modeling (hereafter referred to as \"Agent-Based Modeling\" to avoid any semantic ambiguity in the following description) and Cellular Automata. In comparison to these single paradigms, the hybrid model approach described in this paper fills a technical void and presents several advantages. 4.2.2.1. Multi-agent systems only (IBM/ABM). Two alternatives exist when simulating epidemiologic outbreaks with Agent-Based Modeling (ABM) only.\n\nFirst, agents can be used to represent individuals. This offers flexibility and the highest precision by integrating individual heterogeneities in the model (Kramer-Schadt et al., 2009) . Still, this also comes with some drawbacks, the major one being that the simulation of a large number of individuals is computationally very heavy, posing a problem of tractability (Bansal et al., 2007) . The larger the metapopulation to render, the longer the simulation takes to compute (Fig. 2, top) . This problem does not occur with the hybrid model because the population dynamics is expressed as numbers, relaxing the need to consider each individual explicitly. Also, ABM expresses the behavior of individuals in the form of algorithms. This makes it more difficult to track the epidemic's dynamics than with the stock-and-flow display available in the hybrid model. Indeed, ABM makes it easy to visualize the behavior of individuals, but, unlike System Dynamics, it does not offer a way to explain the causes of the system's behavior.\n\nA second variant is to use agents to represent sites (Keeling et al., 2001) . In this case, the only difference with our solution is that the processes involved in the local outbreaks have to be described algorithmically. This presents no advantage. On the contrary, this form of description can be very hard to understand, analyze, and communicate as visible in an indisputable way throughout the history of software engineering (Eisenstadt, 1993) . The most important factor of problems is the difficulty to create a robust mental model of how an algorithm works (Pennington, 1987; Vessey, 1989) . Notwithstanding the promising standardization of a model description protocol for agent-based models (Grimm et al., 2006; Grimm et al., 2010) and the increasing use of flowcharts to explain algorithms, this remains a delicate issue (see, for example, Pitt et al., 2003) . In the hybrid model, this obstacle is alleviated by the use of System Dynamics and more precisely stock-and-flow representation, which eases the understanding of the functioning of the local epidemiological processes by presenting both the causal relations between the different state variables and parameters (which can be transcribed on paper) and the dynamic variations of the value of each variable at runtime. 4.2.2.2. Cellular Automata (CA). Cellular Automata are natively spatially-explicit and present a regular grid-like structure of interconnected cells. Each cell has states and a neighborhood. The future state of a cell is a function of its current state and the state of its neighbors. All these properties are fitting to describe epidemiological spread. This explains why a significant number of epidemic models, especially probabilistic ones, have been based on this technique (Kawasaki et al., 2006; Schneckenreither et al., 2008; Sirakoulis et al., 2000; White et al., 2007) . The simplicity of the concept of CA also results in simulations with short execution times (Emrich et al., 2008) . Nevertheless, fundamentally, CA is no more suitable than ABM to model network epidemics in a deterministic manner. It has the same downsides as the second variant of ABM models described above for the same reasons. What is more, it presents a further conceptual flaw: modeling a network by a grid is unnatural. In grids, every cell has the same number of other cells to which it is connected. On top of this, these \"neighbors\" are all located in the direct proximity of the cell at equidistant locations. Obviously, this contrasts with the description of metapopulations, which are structurally closer to networks or graphs. In this aspect too, the hybrid approach is more optimal.\n\nThe hybrid model described in this paper is one of a few able to simulate large outbreaks occurring at several concurrent levels. Our metapopulation model offers a tractable deterministic alternative to Watts et al.'s (2005) stochastic formalization of Bailey's (1975) view. An advantage of the present model resides in its capability to serve as platform to free existing compartmental epidemic models from the homogeneous mixing assumption at the metapopulation scale. Traditional compartmental models are generally expressed as ordinary differential equations. System Dynamics, which is used in our hybrid model to render local outbreaks, is based on an ordinary differential equation solver. Therefore, any compartmental model can be very easily imported in the hybrid framework and run in a distributed metapopulation. Moreover, once integrated, its structure is visualized through stock-and-flow representation, thereby making it more intelligible. The switch to System Dynamics also comes along with many precious tools to analyze the model's internal dynamics. In this manner, existing compartmental models can be reused and augmented inside of the hybrid model presented here.\n\nThanks to a spatially-explicit disaggregation of the metapopulation in sites, the capacity to consider local heterogeneities was gained. This is especially valuable if we bear in mind that some usual parameters of compartmental epidemic models rely on local-scale mechanisms. For example, it has been shown that the outcome of Feline Leukemia Virus (FeLV) epizootics can depend heavily on density-dependent host population dynamics (Fromont et al., 2003) , which we are able to integrate on a local scale using the model presented here. Incidentally, the increase in precision allowed by this approach also enables to test local countermeasures, something that traditional compartmental models have not been able to do.\n\nOur hybrid approach lifted the assumption that the metapopulation is well-mixed. Still, it should be noted that the choice of the resolution at which the disaggregation into sites happens is critical to avoid the same approximations as with the previous assumption. Actually, the size of sites must be chosen to maintain a randommixing of the population that they each carry. Ideally, populations should be small enough for each individual to be a potential vector of the disease and be able to infect in a direct manner any other member of the population he belongs to.\n\nAdditionally, under some circumstances, it may be necessary to take individualities into consideration (Bansal et al., 2007; Kramer-Schadt et al., 2009 ). Individual-based models have been used to tackle such situations, but they pose some serious tractability issues (cf. Section 4.2.2). A possible evolution of the current model could offer a way to solve this dilemma. SD-IB hybrid modeling makes it possible to model a component (here, the outbreak dynamics in a local population) in both SD and IBM, but have it simulated in only one of them at a time, with an event triggering the change of paradigm (Vincenot et al., 2011) . Epidemics are more sensitive to individual behaviors in their early stages. Afterwards, their evolution can be rendered with a reasonable approximation with aggregated models relying on the law of large numbers, which have the advantage of being lighter to compute. Therefore, it would be possible to render individual-scale mechanisms at the early stage by having each site also contain an IB model of local outbreak dynamics. As soon as the second phase of the epidemic is reached, the IB model could be replaced dynamically by the SD model to switch back to the previously described solution. In this manner, in case of individuality being a necessary aspect to integrate in the model, this technique would make it possible to opt for an advantageous tradeoff between precision and tractability.\n\nLastly, taking into consideration the deterministic nature of this hybrid model, we ignored on purpose fractions of individuals in the computations (see Section 2.1.6.1). If this choice was adapted for the present study, it induces some shortcomings. The most obvious one is that a parametrization that engenders no global epidemic with our model could very well yield different outcomes when run with a model not based on the previous design choice. Moreover, we can safely assert that our model is not able to cover all the space of possible epidemic scenarios due to this. Therefore, in other works, it could probably be beneficial to wave this limitation. To this end, simply introducing stochasticity represents one obvious solution. When encountering a fraction, the model could simply use it as a probability of the existence of an individual in the compartment considered. Another option lies in the dynamic transition between IBM and SD for the rendering of local outbreaks as described in the previous paragraph, because individuals would be rendered explicitly when present in low numbers. The stochastic interactions of individuals would then translate more accurately what fractions may represent in the aggregated SD model.\n\n\"The pathogen is nothing, the environment is everything\"\n\nThis quotation attributed to physiologist Claude Bernard (1813-1878) should probably be more often minded in the field of epidemiology and animal disease modeling. As already recommended by Hethcote (1995) in his review of \"A thousand and one epidemic models\", we advocate that less time should be spent studying endless parameter variations in compartmental models. Instead, we suggest a reorientation of research efforts towards a deepening of our understanding of the role of metapopulation spatial structure and heterogeneities between populations on the outcome of epidemics. The present study was not aiming at doing an in-depth analysis of network epidemic models, but it pointed out several critical factors that strongly impact them and that cannot be taken into account by traditional compartmental models. Moreover, the divergence between what was displayed by our hybrid model and the results output by a classic compartmental model confirmed that the latter carries several critical limitations, all originating from the premise that the metapopulation is well-mixed. This leads us to stress the importance of lifting this assumption, and more generally to study the effects of spatial disaggregation on compartmental models. To these ends, the original hybrid technique that we have presented here seems like a fitting alternative as regards simplicity, intuitiveness, and analytical power.\n\nFor demonstration purpose, a simplified version of the model presented in this paper has been released online at the following address: http://bre.soc.i.kyoto-u.ac.jp/~vincenot/models.html."}