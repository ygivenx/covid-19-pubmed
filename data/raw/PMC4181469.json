{"title": "Graph-distance distribution of the Boltzmann ensemble of RNA secondary structures", "body": "The distance distribution within an RNA molecule is of interest in various contexts. Most directly, the question arises whether panhandle-like structures (in which 3\u2019 and 5\u2019 ends of long RNA molecules are placed in close proximity) are the rule or an exception. Panhandles have been reported in particular for many RNA virus genomes. Several studies [1-4] agree based on different models that the two ends of single-stranded RNA molecules are typically not far apart. On a more technical level, the problem to compute the partition function over RNA secondary structures with given end-to-end distance d, usually measured as the number of external bases (plus possibly the number of structural domains) arises for instance when predicting nucleic acid secondary structure in the presence of single-stranded binding proteins [5] or in models of RNA subjected to pulling forces (e.g. in atom force microscopy or export through a small pore) [6-8]. It also plays a role for the effect of loop energy parameters [9].\n\nIn contrast to the end-to-end distance, the graph-distance between two arbitrarily prescribed nucleotides in a larger RNA structure does not seem to have been studied in any detail. However, this is of particular interest in the analysis of single-molecule fluorescence resonance energy transfer (smFRET) experiments [10]. This technique allows to monitor the distance between two dye-labeled nucleotides and can reveal details of the kinetics of RNA folding in real time. It measures the non-radiative energy transfer between the dye-labeled donor and acceptor positions. The efficiency of this energy transfer, E\nfret\n, strongly depends on the spatial distance R according to Efret=R06/(R06+R6). The F\u00f6rster radius R0 sets the length scale, e.g. R0\u224854 \u00c5 for the Cy3-Cy5 dye pair. A major obstacle is that, at present, there is no general and efficient way to link smFRET measurements to interpretations in terms of explicit molecular structures. To solve this problem, a natural first step is to compute the distribution of spatial distances for an equilibrium ensemble of 3D structures. Since this is not feasible in practice despite major progress in the field of RNA 3D structure prediction [11], we can only resort to considering the graph-distances on the ensemble of RNA secondary structures instead. From a computer science point of view, furthermore, we show here that the distance distribution can be computed exactly using a dynamic programming approach. Although a crude approximation of reality, our initial results indicate that the graph-distance can be related to the smFRET data such as those reported by [12] and help to explain effects of RNA structures in pre-mRNA splicing and viral subgenomic RNA species.\n\nAn RNA secondary structure is a vertex labeled outerplanar graph G(V,x,E), where V = {1,2,\u2026,n} is a finite ordered set (of nucleotide positions) and x : {1,2,\u2026,n} \u2192 {A,U,G,C},i \u21a6 x\ni\n assigns to each vertex at position i (along the RNA sequence from 5\u2019 to 3\u2019) the corresponding nucleotide x\ni\n. We write x = x1\u2026x\nn\n for the sequence underlying secondary structure and use x[ i\u2026j] = x\ni\n\u2026x\nj\n to denote the subsequence from i to j. The edge set E is subdivided into backbone edges of the form {i,i + 1} for 1 \u2264 i<n and a set B of base pairs satisfying the following conditions: \n\n(i) If {i,j} \u2208 B then x\ni\nx\nk \n\u2208 {GC,CG,AU,UA,GU,UG};\n\n(ii) If {i,j} \u2208 B then |j - i| > 3;\n\n(iii) If {i,j},{i,k} \u2208 B then j = k;\n\n(iv) If {i,j},{k,l} \u2208 B and i < k < j then i < l < j.\n\nThe first condition allows base pairs only for Watson-Crick and GU base pairs. The second condition implements the minimal steric requirement for an RNA to bend back on itself. The third condition enforces that B forms a matching in the secondary structure. The last condition (nesting condition) forbids crossing base pairs, i.e. pseudoknots.\n\nThe nesting condition results in a natural partial order in the set of base pairs B defined as {i,j} \u227a {k,l} if k < i < j < l. In particular, given an arbitrary vertex k, the set B\nk \n= {{i,j} \u2208 B|i \u2264 k \u2264 j} of base pairs enclosing k is totally ordered. Note that k is explicitly allowed to be incident to its enclosing base pairs. A vertex k is external if B\nk \n= \u2205 . A base pair {k,l} is external if B\nk \n= B\nl \n= {{k,l}}.\n\nConsider a fixed secondary structure G, for a given base pair {i,j} \u2208 B, we say a vertex k is accessible from {i,j} if i < k < j and there is no other pair {i\u2032,j\u2032} \u2208 B such that i < i\u2032 < k < j\u2032 < j. The unique subgraph \u2112i,j induced by i, j, and all the vertices accessible from {i,j} is known as the loop of {i,j}. The type of a loop \u2112i,j is unique determined depending on whether {i,j} is external or not, and the numbers of unpaired vertices and base pairs. For details, see [13]. Each secondary structure G has a unique set of loops {\u2112i,j|{i,j}\u2208B}, which is called the loop decomposition of G. The free energy f(G) of a given secondary structure, according to the standard energy model [14], is defined as the sum of the energies of all loops in its unique loop decomposition.\n\nThe relative location of two vertices v and w in G is determined by the base pairs B\nv\n and B\nw\n that enclose them. If B\nv \n\u2229 B\nw \n\u2260 \u2205, there is a unique \u227a-minimal base pair {i\nv,w\n,j\nv,w\n} that encloses both vertices and thus a uniquely defined loop \u2112{iv,w,jv,w} in the loop associated with v and w. If B\nv \n\u2216 B\nw \n= \u2205  or B\nw \n\u2216 B\nv \n= \u2205 then v or w is unpaired and part of \u2112{iv,w,jv,w}. Otherwise, i.e. B\nv \n\u2229 B\nw \n= \u2205, there are uniquely defined \u227a-maximal base pairs {k\nv\n,l\nv\n} \u2208 B\nv \n\u2216 B\nw\n and {k\nw\n,l\nw\n} \u2208 B\nw \n\u2216 B\nv\n that enclose v and w, respectively. We note that B\nv \n\u2216 B\nw\n (B\nw \n\u2216 B\nv\n) may be empty, in which case {k\nv\n,l\nv\n} ({k\nw\n,l\nw\n}) is also empty. This simple partition holds the key to computing distance distinguished partition functions below.\n\nIn the following, we assign the weights a for backbone edges and b for base pairs, respectively. Given a path p, we define the weight of the path d(p) as the sum of the weights of edges in the path. The (weighted) graph-distancedv,wG in G is defined as the weight of the path p connecting v and w with d(p) being minimal. For the weights, we require the following condition: \n\n\u2022 If i and j are connected by an edge, then {i,j} \u2208 E is the unique shortest path between i and j.\n\nThis condition ensures that single edges cannot be replaced by detours of shorter weight. Condition (W) and property (ii) of the secondary structure graphs implies b < 3a because the closing base pair must be shorter than a hairpin loop. Furthermore, considering a stacked pair we need b < b + 2 a, i.e. a > 0. We allow the degenerate case b = 0 that neglects the traversals of base pairs.\n\nBefore we continue with the calculations of the partition function, let us first consider the problem formulation in more detail. For the FRET application, it is well-known that FRET efficiency is correlated with spatial distance. Furthermore, only a limited range of distance changes (e.g. 20 \u00c5-100 \u00c5 for Cy3-Cy5) can be reported by the FRET experiments. Thus a more useful formulation of our problem is not to use the full expected quantity for all positions. Instead, we are interested in the average for all distance-values within some threshold \u03b8\nd\n. As the space and time complexity will depend on the number of distances we consider, we will parametrise our complexity by the number of nucleotides n and the number of distances considered D = \u03b8\nd \n+ 1, as well. In the worst case, there is D = O (n). However, given that in practice only a limited range of distance changes are considered, we rather view D = O(1) as a small constant in our contribution.\n\nFor a fixed structure G, dv,wG is easy to compute. Here, we are interested in the distribution Pr[dv,wG|x] and its expected value dv,w=E[dv,wG|x] over the ensemble of all possible structures G for a given sequence x. Both quantities can be calculated from the Boltzmann distribution Pr[ G|x] = e- f (G)/R\nT\n/Q where Q=\u2211Ge-f(G)/RT denotes the partition function of the ensemble of structures. As first shown in [15], Q and related quantities can be computed in quartic time. A reduction to a cubic algorithm may be obtained if the free energy of long interior loops may be regarded as prohibitive. This restriction has been widely used for long sequences [16]. Cubic runtime can also be achieved for some but not all parametrizations of interior loop energies [17].\n\nA crucial quantity for our task is the restricted partition function \n\nZv,w[d]=\u2211Gwithdv,wG=de-f(G)/RT\n\n for a given pair v,w of positions in a given RNA sequence x. A simple computation (Appendix A in Additional file 1) verifies that the Pr[dv,wG=d|x]=Zv,w[d]/Q and dv,w=E[dv,wG|x]=\u2211d(Zv,w[d]/Q)d. Hence it suffices to compute Z\nv,w\n[d] for any 1 \u2264 d \u2264 n. In the following sections we show that this can be achieved by a variant of McCaskill\u2019s approach [15].\n\nFor the ease of presentation we describe in the following only the recursion for the simplified energy model for the \u201ccircular maximum matching\u201d, in which energy contributions are associated with individual base pairs rather than loops. Our approach can be easily extended to the full model by using separating the partition functions into distinct cases for the loop types.\n\nWe use the letters Z and Y to denote partition functions with distance constraints, while Q is used for quantities that appear in McCaskill\u2019s algorithm and are considered as pre-computed here. For instance, let Qi,jB denote the partition function over all secondary structures on x[ i..j] that are enclosed by the base pair {i,j}. We will later also need the partition function Q\ni,j\n over the sub-sequence x [ i..j], regardless of whether {i,j} is paired or not. In Additional file 1: Appendix C, we summarize the notations frequently used in our contribution.\n\nAn important special case assumes that both v and w are external. This is the case e.g. when v and w are binded by proteins. In particular, the problem of computing end-to-end distances, i.e., v = 1 and w = n, is of this type.\n\nAssuming (W), the shortest path between two external vertices v,w consists of the external vertices and their backbone connections together with the external base pairs. We call this path the inside path of i,j since it does not involve any vertices \u201coutside\u201d the subsequence x [ i..j].\n\nFor efficiently calculating the internal distance between any two vertices v,w, we denote by Zi,jI[d] the partition function over all secondary structures on x [ i..j] with distance exactly d.\n\nNow note that any structure on x[ i..j] starts either with an unpaired base or with a base pair connecting i to some position k satisfying i < k \u2264 j. In the first case, we have di,jG=di,i+1G+di+1,jG where di,i+1G=a. In the second case, there exists di,jG=di,kG+dk,k+1G+dk+1,jG with di,kG=b and dk,k+1G=a. Thus, Zi,jI[d] can be split as follows, \n\nThis gives the recursion \n\n(1)Zi,jI[d]=Zi+1,jI[d-a]+\u2211i<k\u2264jQi,kBZk+1,jI[d-b-a]\n\nwith the initialization ZiiI[0]=1 and ZiiI[d]=0 for d > 0. For consecutive vertices, we have Zi,i+1I[a]=1 and Zi,i+1I[d]=0 for d \u2260 a. These recursions have been derived in several different contexts, e.g. force induced RNA denaturations [6], the investigate of loop entropy dependence [9], the analysis of FRET signals in the presence of single-stranded binding proteins [5], as well as in mathematical studies of RNA panhandle-like structures [3,4].\n\nIn the following, it will be convenient to define also a special term for the empty structure. Setting Zi,i-1I[-a]=1 and Zi,i-1I[d]=0 for d \u2260 -a allows us to formally write an individual backbone edge as two edges flanking the empty structure and hence to avoid the explicit treatment of special cases. This definition of Z\nI\n also includes the case that i and j are base paired in the recursion (1). This is covered by the case k=j, where we evaluate Zj+1,jI[d-b-a]. Since d = b is the only admissible value here, this refers to Zj+1,jI[-a], which has the correct value of 1 due to our definition. Later on, we will also need Z\nI\n under the additional condition that the path starts and ends with a backbone edge. We therefore introduce ZI\u2032 defined as by \n\n(2)Zi,jI\u2032[d]=Zi+1,j-1I[d-2a]\n\nNote that if Zi,jI\u2032[d] is called with j = i + 1, then we call Zi+1,iI[d-2a]. The only admissible value again is the correct value d=a. In sum, we have the following \n\nThis recursion requires O(n3D) time and O(n2D) space. It is possible to reduce the complexity of computing the expected distance in this special case by a linear factor. The trick is to use conditional probabilities for arcs starting at i or the conditional probability for i to be single-stranded, which can be determined from the partition function for RNA folding [3], see Additional file 1: Appendix B.\n\nOne example of this case is given in Figure 1 with the red and blue region, where v (vertex in green region) is covered by an arc, and w (vertex in blue region) is external. Denote the \u227a-maximal base pair enclosing v by {i,j}. Since at most one of v and w is covered by an arc, we know that j < w. Hence, every path p from v to w, and hence also the shortest paths (not necessarily unique) must run through the right end j of the arc {i,j}. More precisely, there must sub-paths p1 and p2 with d (p) = d(p1) + d (p2) + a such that v\u21ddpw\u2192v\u21ddp1j-(j+1)\u21ddp2w, where i\u21ddpj denotes that p is a shortest path from i to j and - denotes a single backbone edge. For the shortest path from v to j, it consists either of a shortest path v\u21ddp\u2032i and the arc {i,j}, or it goes directly to j without using the arc {i,j}.\n\nHow does this distinction translate to the partition function approach? If we want to calculate the contribution of this case to the partition function Z\nv,w\n[ d], we have to split both the sequence x[ i,w] and distance d as follows\n\na.) \n\n where Zj,wI\u2032[d2] is the partition function starting and ending with a single-stranded base as defined in Equation (2), and Zi,jB,v[d\u2113,dr] is the partition function consisting of all structures of x[ i,j] containing the base pair {i,j} with the property that the shortest path from v to i has length d\n\u2113\n and the shortest path from v to j has length d\nr\n. In addition, d, d\nr\n and d2 must satisfy d = d\nr \n+ d2.\n\nThe remaining cases for the contribution of the class \u03a90 to Z\nv,w\n[ d] are given by all other possible combinations of v and w being single-stranded or being covered by an arc, i.e., \n\nTo simplify, we extend the definition of Zi,jB,v[d\u2113,dr] by setting Zv,vB,v[0,0]=1 and Zv,vB,v[d\u2113,dr]=0 for d\n\u2113 \n+ d\nr \n> 0. This allows us to conveniently model all cases where either v or w are external, i.e., a.), b.), and d.), as special cases of c.).\n\nIn case c.), we have to split the distance d into five sub-distances dl,dr,dl\u2032,dr\u2032,dI, in which d\nI\n can be retrieved from the first four distances. Furthermore, we would require four splitting positions for the sequence for all possible combinations of i,j,k,l. A na\u00efve implementation of this idea would result in an algorithm with time complexity O(n6D5) and space complexity O(n2D2).\n\nA careful inspection shows, however, that the split of the distances for the arcs into d\n\u2113\n and d\nr\n is unnecessary. Since we want to know only distance to the left/right end, we can simply introduce two matrices Zi,jB,v,\u2113[d] and Zi,jB,v,r[d] that store these values. These matrices can be generated from Zi,jB,v[d\u2113,dr] as follows: \n\nZi,jB,v,\u2113[d]=\u2211drdr+b\u2265dZi,jB,v[d,dr]+\u2211d\u2113d\u2113>dZi,jB,v[d\u2113,d-b]\n\nAnalogously, we compute Zi,jB,v,r[d]. In this way, we split the distance d into three contributions and we require four splitting positions for the sequence for all possible combinations of i,j,k,\u2113. \n\nTherefore, the contribution to Z\nv,w\n[ d] for structures in \u03a90 is given by \n\n(3)Z0v,w[d]=\u2211d1,d2d1+d2\u2264d\u2211i,j,k,li\u2264v\u2264j<k\u2264w\u2264lQ1,i-1\u00b7Zi,jB,v,r[d1]\u00b7Zj,kI\u2032[d-(d1+d2)]\u00b7Zk,lB,w,\u2113[d2]\u00b7Ql+1,n\n\nNote that for splitting the distance, we reuse the same indices (e.g., the j in Zi,jB,v,r[d1]\u00b7Zj,kI\u2032[d-(d1+d2)], where as for the remaining partition function, we use successive indices (e.g.,the i in Q1,i-1\u00b7Zi,jB,v,r[d1]). This difference comes from the fact that splitting a sequence into subsequences is done naturally between two successive indices, whereas splitting a distance is naturally done by splitting at an individual position. We have only to guarantee that the substructures which participate in the split do agree on the structural context of the split position. This is guaranteed by requiring that ZI\u2032 starts and ends with a backbone edge. We note that the incorporation of the full dangling end parameters makes is more tedious to handle the splitting positions.\n\nThis results in a complexity of O(n6D3) time and O(n2D) space. However, we do not need to split in i,j,k,l simultaneously. Instead, we could split case (c) at position j and introduce for all v \u2264 j and k \u2264 w the auxiliary variables \n\nZ1,jB,v,r[d1]=\u2211i\u2264vQ1,i-1\u00b7Zi,jB,v,r[d1]Zk,nB,w,\u2113[d2]=\u2211w\u2264lZk,lB,w,\u2113[d2]\u00b7Ql+1,nZj,nIB,w,\u2113[d\u2032]=\u2211k>j\u2211d2\u2264d\u2032Zj,kI\u2032[d\u2032-d2]\u00b7Zk,nB,w,\u2113[d2].\n\nFinally, we can replace recursion (3) by \n\n(4)Z0v,w[d]=\u2211v\u2264j\u2211d1\u2264dZ1,jB,v,r[d1]\u00b7Zj,nIB,w,\u2113[d-d1]\n\nWe thus arrive at O(n3D2) time and O(n2D) space complexity for the contribution of \u03a90 structures to Z\nv,w\n[ d], excluding the complexity of computing Zi,jB,v[d\u2113,dr].\n\n\u03a91 contains all cases where v and w are covered by a base pair. In the following, let {p,q} be the \u227a-minimal base pair covering v and w. In principle, this case looks similar to the case for \u03a90. However, we have to take into considerations the paths between v and w over the base pair {p,q}. Thus, we need to store the partition function for all inside and outside for each \u227a-minimal arc {p,q} that covers v and w, which we will call Zp,qv,w[dO,dI]. In principle, a similar recursion as defined for Z0v,w in equation (3) can be derived, with the additional complication since we have to take care of the additional outside distance due to the arc {p,q}. Thus, we obtain the following splitting: \n\nAgain we can avoid the complexity of simultaneously splitting at {i,j}and {k,l} by doing a major split after j. Thus, we get the following picture, \n\n which leads to the following equivalent recursions: \n\n(5)Yp,jB,v,r[d,dr]=\u2211p<i\u2264v\u2211dO\u2032\u2264dZp,iI\u2032[dO\u2032]\u00b7Zi,jB,v[d-dO\u2032,dr]\n\n(6)Yk,qB,w,\u2113[d\u2113\u2032,d\u2032]=\u2211w\u2264l<q\u2211dO\u2032\u2032\u2264d\u2032Zk,lB,w[d\u2113\u2032,d\u2032-dO\u2032\u2032]\u00b7Zl,qI\u2032[dO\u2032\u2032]\n\n(7)Yj,qIB,w,\u2113[dI\u2113,d\u2032]=\u2211j<k<q\u2211d\u2113\u2032\u2264dI\u2113Zj,kI\u2032[dI\u2113-d\u2113\u2032]\u00b7Yk,qB,w,\u2113[d\u2113\u2032,d\u2032]\n\nOverall, we get the following recursion: \n\n(8)Zp,qv,w[dO,dI]=\u2211v\u2264j\u2211dr\u2264dId\u2264dOYp,jB,v,r[d,dr]\u00b7Yj,qIB,w,\u2113[dI-dr,dO-d]\n\nWe can now define Z\nv,w\n[ d] by \n\n(9)Zv,w[d]=Z0v,w[d]+Q^p,qb\u00b7\u2211{p,q}\u2260{v,w}dI\u2265d+bZp,qv,w[d,dI]+\u2211{p,q}\u2260{v,w}d<dO+bZp,qv,w[dO,d]\n\nwhere Q^p,qb is the external partition function over all structures on the union of the intervals x[ 1..p] \u222a x[ q..n] so that {p,q} is a base pair. Since the base pair probability can be written as Pr({p,q})=Q^p,qbQp,qbQ, this quantity can be calculated as Q^p,qb=Pr({p,q})QQp,qb. The base pair probability Pr ({p,q}), and the partition functions Q and Qp,qb are computed by means of McCaskill\u2019s algorithm.\n\nThis part now has a complexity of O(n2D2) space and O(n3D4) time. For practical applications, however, we do not need to consider all possible {p,q}. Instead, there are only few base pairs that are likely to form and that cover v,w, especially for v,w where the internal distance of v,w is large enough such that an outside path has to be considered at all. If we assume a constant number of such long-range base-pairs, then the complexity is reduced by an n2-factor. For the complexity in terms of distance, recall that D is typically small.\n\nSo far, we have used Zi,jB,v[d\u2113,dr] as a black box. In order to compute these terms, we distinguish the limiting cases a.) v = i, b.) v = j, c.) is external from the generic case d.): \n\nStarting from the limiting cases, we initialize Zv,jB,v[0,dr] as follows: \n\nZv,jB,v[0,dr]=Zv,jI\u2032[dr]fora\u2264dr<b\u2211d\u2032\u2265bZv,jI\u2032[d\u2032]fordr=b0otherwise\n\n and analogously for Zi,vB,v[d\u2113,0]. Furthermore, Zi,jB,v[0,0]=0 for i \u2260 v \u2260 j. These conventions allow us to model all cases as special cases of d). Our key observation here is that the dependency between d\n\u2113\n and d\nr\n can be used to reduce the time complexity. Instead of using the variables d\n\u2113\n and d\nr\n in Zi,jB,v[d\u2113,dr], we use the pair d\n\u2113\n,dadd in Zi,jB,v[d\u2113,d\u2113+dadd]. Similarly, we use d\u2113\u2032,dadd\u2032 instead of d\u2113\u2032,dr\u2032 for the inner base pair, which then determines completely the splitting the distances. This results in an recursion for Zi,jB,v[d\u2113,d\u2113+dadd] with complexity O(n4D2cb2) time and O (n2Dc\nb\n) space. To be precise, there are three sub-cases as follows. \n\nThe values that are chosen to split d\n\u2113\n and dadd are indicated in green and blue. When the arc {i,j} is colored violet, then there is a shortest path that does not use the distance marked in red but uses the other direction together with the arc {i,j}. If -b<d\nadd\n<+b, then we know that neither a shortest path v\u21ddpi nor v\u21ddpj uses the arc {i,j}. The left distance is thus given by d\u2113-d\u2113\u2032. Using the shortcuts d\nr \n= d\n\u2113 \n+ dadd and dr\u2032=d\u2113\u2032+dadd\u2032, then the distance between l and j must be dr-dr\u2032=(d\u2113+dadd)-d\u2113\u2032+dadd\u2032. If, on the other hand, dadd = + b, then we know that there is at least one shortest path that can be composed by using a shortest path v\u21ddi, followed by the arc {i,j}. This of course implies that the shortest path v\u21ddpj is has exactly the length d\n\u2113 \n+ b, or is larger. For a sub-path l+1\u21ddp\u2032j this implies that the length is greater or equal d=dr-dr\u2032=d\u2113+b-d\u2113\u2032+dadd\u2032. Thus, we just have to add all partition functions Zk,jI\u2032[d\u2032] with d\u2032 > d. This can be done efficiently by using a precalculated matrix Zi,jI\u2032\u2265[d], which is defined as \u2211d\u2032\u2265dZi,jI\u2032[d\u2032]. Note that Zi,jI\u2032\u2265[d] can also be defined if we restrict in all recursion the distance d to a threshold \u03b8\nd\n, since Zi,jI\u2032\u2265[d]=\u2211d\u2032\u2265dZi,jI\u2032[d\u2032]=Qi,j\u2032-\u2211d\u2032<dZi,jI\u2032[d\u2032]. In which, where Qi,j\u2032 is Q\ni + 1,j - 1 if j > i + 1, 1 if j = i + 1 and 0 otherwise. Note, furthermore, that all Zi,jI\u2032[d\u2032] for d\u2032< d \u2264 \u03b8\nd\n are calculated when we restrict the distance to \u03b8\nd\n.\n\nFinally, if dad d= - b, then the shortest path l\u21ddpj has distance (d\u2113-b)-d\u2113\u2032+dadd\u2032. For the shortest path k\u21ddpi, we know that it has length d\u2113-d\u2113\u2032 or greater, which can be resolved by again using Zi,k-1I\u2032\u2265[d\u2113-d\u2113\u2032]. Thus, we get the following optimized recursion for Zi,jB,v[d\u2113,d\u2113+dadd] with d\n\u2113 \n\u2260 0 and d\n\u2113 \n+ dadd \u2260 0: \n\n(10)Zi,jB,vdl,dl+dadd=\u2211k\u2260li<k\u2264vv\u2264l<j\u2211dl\u2032\u2264dl\u2211dadd\u2032-b\u2264dadd\u2032\u2264bZi,kI\u2032dl-dl\u2032\u00b7Zk,lB,vdl\u2032,dl\u2032+dadd\u2032\u00b7Zl,jI\u2032dl+dadd-dl\u2032+dadd\u2032if-b<dadd<b\u2211k\u2260li<k\u2264vv\u2264l<j\u2211dl\u2032\u2264dl\u2211dadd\u2032-b\u2264dadd\u2032\u2264bZi,kI\u2032dl-dl\u2032\u00b7Zk,lB,vdl\u2032,dl\u2032+dadd\u2032\u00b7Zl,jI\u2032\u2265dl-b-dl\u2032+dadd\u2032ifdadd=b\u2211k\u2260li<k\u2264vv\u2264l<j\u2211dl\u2032\u2264dl\u2211dadd\u2032-b\u2264dadd\u2032\u2264bZi,kI\u2032dl-dl\u2032\u00b7Zk,lB,vdl\u2032,dl\u2032+dadd\u2032\u00b7Zl,jI\u2032dl-b-dl\u2032+dadd\u2032ifdadd=-b\n\nThe theoretical analysis of the distance distribution problem shows that, while polynomial-time algorithms exist, they probably cannot be improved to space and time complexities that make them widely applicable to large RNA molecules. Due to the unfavorable time complexity of the current algorithm and the associated exact implementation in C, a rather simple and efficient sampling algorithm has been implemented. We resort to sampling Boltzmann-weighted secondary structures with RNAsubopt -p[16], which uses the same stochastic backtracing approach as sfold[18]. As the graph-distance for a pair of nucleotides in a given secondary structure can be computed in O(n logn) time by Dijkstra\u2019s algorithm with Fibonacci heap [19], even large samples can be evaluated efficiently.\n\nAs we pointed out in the introduction, the graph-distance measure introduced in this paper can serve as a first step towards a structural interpretation of smFRET data. As an example, we consider the graph distance distribution of a Diels-Alderase (DAse) ribozyme (Figure 2A). Histograms of smFRET efficiency (E\nfret\n) for this 49 nt long catalytic RNA are reported in [12] for a large number of surface-immobilized ribozyme molecules as a function of the Mg 2+ concentration in the buffer solution. A sketch of their histograms is displayed in Figure 2B. The dyes are attached to sequence positions 6 (Cy3) and 42 (Cy5) and hence do not simply reflect the end-to-end distance, Figure 2A(c). In this example, we observe the expected correspondence small graph-distances with a strong smFRET signal. This is a particular interesting example, since the minimal free energy (mfe) structure (Figure 2A(a)) predicted with RNAfold is not identified with the real secondary structure (Figure 2A(c)). In fact, the ground state secondary structure is ranked as the 3rd best sub-optimal structure derived via RNAsubopt -e. The free energy difference between these two structures is only 0.1 kcal/mol. However, their graph-distances show a relatively larger difference. The 2nd best sub-optimal structure (Figure 2A(b)) looks rather similar with the 3rd structure, in particular, they share the same graph-distance value.\n\nThe smFRET data of [12] indicates the presence of three sub-populations, corresponding to three different structural states: folded molecules (state F), intermediate conformation (state I) and unfolded molecules (state U). In the absence of Mg 2+, the I state dominates, and only small fractions are found in states U and F. Unfortunately, the salt dependence of RNA folding is complex [21,22] and currently is not properly modeled in the available folding programs. We can, however, make use of the qualitative correspondence of low salt concentrations with high temperature. In Figure 2C we therefore re-compute the graph-distance distribution in the ensemble at an elevated temperature of 50\u00b0C. Here, the real structure becomes the second best structure with free energy -10.82 kcal/mol and we observe a much larger fraction of (nearly) unfolded structures with longer distances between the two beacon positions. Qualitatively, this matches the smFRET data showed in Figure 2B.\n\nFurthermore, for a given pair v,w of positions in a given RNA sequence x, the importance I\nv,w\n(e) of a backbone edge or base pair e in calculating the graph-distance distribution is evaluated by Iv,w(e)=\u2211e\u2208\u03a0ePr[G|x], where the set \u03a0\ne\n comprises the secondary structures G with (at least) one shortest path between v and w that runs through e. Figure 3 compares dot plots of I\nv,w\n(e) with the base-pair probabilities in the RNA structure ensemble of the DAse ribozyme at temperatures 37\u00b0C and 50\u00b0C. Since RNAgraphdist computes only one of possible many shortest paths for each G, hence we obtain only a lower bound on I\nv,w\n(e).\n\nWe observe for DAse that the contributions from the backbone edges are larger than the base pairs at both temperatures. For T = 37\u00b0C, there are in total 14 edges with I6,42(e) > 0.4. Only two of them, 5(C)\u201318(G) and 2(G) \u2013 21(C) are base pairs. For T = 50\u00b0C, there is only the pair 5(C) \u2013 18(G) is heavily used (I6,42(5,18) = 0.636). Combining the analysis of data illustrated in Figure 2, it may indicate that the existences of two base pairs, 2(G) \u2013 21(C) and 28(G) \u2013 39(C) can affect the graph-distance distribution of RNA secondary structure ensemble and consequently affect smFRET measurements. Such constraints may become an interesting source of constraints for RNA structure prediction.\n\nIn addition, we compute the distribution of paths which pass through positions outside sequence interval x[ 6-h,42+h] of DAse ribozyme. As illustrated in Figure 4, this \u201coutside-path\u201d distribution, as expected, drops fast to 0 with respect to h.\n\nLong-range interactions play an important role in pre-mRNA splicing and in the regulation of alternative splicing [23-25], bringing splice donor, acceptor, branching site into close spatial proximity. Figure 5A shows for D. melanogaster pre-mRNAs that the distribution of graph-distances between donor and acceptor sites shifted towards smaller values compared to randomly selected pairs of positions with the same distance. Due to the insufficiency of the spacial-distance information of structural elements in the secondary structures, we artificially choose a = b = 1 in our experiments. Although the effect is small, it shows a clear difference between the real RNA sequences and artificial sequences that were randomized by di-nucleotide shuffling. Furthermore, Table 1 displays for a specific intron CG16979-RA_intron_0_0_chr3L_15569803 from Drosophila melanogaster (dm3), the most probable secondary structures in the sub-ensembles of secondary structures such that their graph-distances are 7, 6, and 14, respectively.\n\nThe Drosophila melanogaster Down syndrome cell adhesion molecules (DSCAM) encodes for 38.016 different mRNAs by alternative splicing. Among the 24 exons, exon 4 alone has 12 variants [26]. In Figure 6 we display the graph-distance from donor (exon 3) to any downstream position until acceptor (exon 5). Comparing the graph-distances of all twelve acceptors of exon 4, we see clearly local peaks. This suggests the acceptor being part of hairpin loops, three dimensionally poking out of the long transcript to interact easily with the spliceosome and donor. Four of the twelve acceptor sites show no local peak, however seem to be accessible as internal loops of longer hairpins.\n\nThe spatial organization of the genomic and sub-genomic RNAs is important for the processing and functioning of many RNA viruses. This goes far beyond the well-known panhandle structures. In Coronavirus the interactions of the 5\u2019 TRS-L cis-acting element with body TRS elements has been proposed as an important determinant for the correct assembly of the Coronavirus genes in the host [27]. The mechanisms of interaction is unknown, and a small three-dimensional distance is suspected. The matrix of expected graph-distances in Figure 5B shows that TRS-L and TRS-B are indeed placed close to each other. In Table 2, we show the most stable structures within the sub-ensembles of secondary structures such that their graph-distances are 14, 5, and 35, respectively. All these RNA secondary structures brings the leader transcription regulation site (L-TRS) in close spatial proximity with the body transcription regulation site (B-TRS).\n\nThese examples indicate that the systematic analysis of the graph-distance distribution both for individual RNAs and their aggregation over ensembles of structures can provide useful insights into structural influences on RNA function. These may not be obvious directly from the structures due to the inherent difficulties of predicting long-range base pairs with sufficient accuracy and the many issues inherent in comparing RNA structures of very disparate lengths.\n\nDue the complexity of algorithm we have refrained from attempting a direct implementation in an imperative programming language. Instead, we are aiming at an implementation in Haskell that allows us to make use of the framework of algebraic dynamic programming [28]. The graph-distance measure and the associated algorithm can be extended in principle to of RNA secondary structures with additional tertiary structural elements such as pseudoknots [29] and G-quadruples [30]. RNA-RNA interaction structures [31] also form a promising area for future extensions. We note finally, that the Fourier transition method introduced in [32] could be employed to achieve a further speedup.\n\nThe distribution of spatial distances in the equilibrium structure ensemble of an RNA molecule carries information about the overall structure of the molecule. These distance can be approximated by the graph-distance in RNA secondary structure. We introduced a polynomial time algorithm to compute the equilibrium distribution of graph-distances between a fixed pair of nucleotides. For practical applications, small distances are of main interest. Here, the time complexity of the proposed algorithm is O(n4), compared to a na\u00efve implementation with time complexity of O(n11) for sequence length n and distances that can cover the whole sequence length. Since further reductions, however, seem to be difficult, we also introduced sampling approaches that are much easier to implement. They are also theoretically favorable for several real-life applications, in particular since these primarily concern long-range interactions in very large RNA molecules.\n\nThe authors declare that they have no competing interests.\n\nConceived and designed the algorithms: JQ, PFS and RB. Implemented algorithms and performed experiments: JQ and MN. Analyzed Diels-Alderase ribozyme data: JQ and PFS. Analyzed pre-mRNA splicing data: MN and MM. Wrote the final manuscript: JQ, MM, PF and RB. All authors read and approved the final manuscript."}