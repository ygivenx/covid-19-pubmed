{"title": "A flexibly shaped space-time scan statistic for disease outbreak detection and monitoring", "body": "Consider the situation where an entire study area is divided into m regions (for example, counties, ZIP codes, enumeration districts, etcetera), and each region is periodically reporting the number of cases of a disease or syndrome under study. We assume that, under the null hypothesis of no clustering, the number of cases Nid is a Poisson random variable with the observed value nid and the expected values \u03bcid in each region i(i = 1,...,m) at time d, where \u03bcid is proportional to its population size, or a covariate-adjusted population at risk. Since we are only interested in detecting clusters that are alive (active) at the current time tP, we only consider 'alive' clusters that are present in the following T time intervals:\n\n[tP - T + 1, tP], [tP - T + 2, tP],..., [tP - 1,tP], [tP, tP]\n\nwhere T is a pre-specified maximum temporal length of the cluster.\n\nA time periodic geographical disease surveillance system based on a cylindrical space-time scan statistic has already been proposed by Kulldorff [10]. The cylindrical space-time scan statistic uses a cylindrical window in three dimensions where the base of the cylinder represents space and the height represents time. As with the purely spatial scan statistic, the cylindrical space-time scan statistic imposes a circular base Z on each centroid of regions for each of T time intervals. For each of centroids, the radius of the circle is varied from zero up to a pre-set maximum radius, for example, so that the window never includes more than 50% of the total population at risk [8]. In this paper, we use a pre-set maximum number of regions K to be included in the cluster as an upperbound of the radius. If the base contains the centroid of a region, then that whole region is included in the base. In total, a very large number of different but overlapping circular bases are created, each with a different set of neighboring regions and each being a possible candidate area containing a disease outbreak. Let Zik, k = 1,...,K, denote the base composed by the region i and the (k - 1)-nearest neighbors to i. Then, all the cylindrical windows to be scanned by the cylindrical scan statistic are the cylinders with the base in the set\n\n(1)Z1={Zik|1\u2264i\u2264m,1\u2264k\u2264K}\n\nand the heights in the set\n\n(2)Y={[tP\u2212t+1,tP]|1\u2264t\u2264T},\n\nOn the other hand, a flexible space-time scan statistic which we propose in this paper imposes a three dimensional prismatic window with an arbitrarily shaped base Z. For any given region i, we create the set of arbitrarily shaped bases consisting of k connected regions (1 \u2264 k \u2264 K) including i. To avoid detecting a cluster of unlikely peculiar shape, the connected regions are restricted as the subset of the K-nearest neighbors to the region i, where K = 1 implies the region i itself. Let Zik(j), j = 1,...,jik denote the j-th window which is a set of k regions connected starting from the region i, where jik is the number of j satisfying Zik(j) \u2286 ZiK for k = 1,...,K. Then, all the windows to be scanned are the prisms whose base is included in the set\n\n(3)Z2={Zik(j)|1\u2264i\u2264m,1\u2264k\u2264K,1\u2264j\u2264jik}\n\nwith height in the set Y. In other words, for any given region i, the cylindrical scan statistic consider K concentric circles for the base, whereas the flexible scan statistic consider K concentric circles plus all the sets of connected regions including the single region i, whose centroids are located within the K-th largest concentric circle.\n\nDefine L(W) as the likelihood under the alternative hypothesis that there is a cluster in the space-time window W(\u2208 W), where W=Z1\u00d7Y (or Z2\u00d7Y) and L0 the likelihood under the null hypothesis. Then, conditioning on the observed total number of cases, N, the definition of the space-time scan statistic S is the maximum likelihood ratio over all possible windows W,\n\n(4)S=max\u2061W\u2208W{L(W)}L0=max\u2061W\u2208W{L(W)L0}.\n\nLet nW be the number of cases in window W . For the Poisson model, let \u03bcW be the expected number in window W under the null hypothesis, so that \u03bcG = N for G, the entire study space in three dimensions. It can then be shown that\n\n(5)L(W)L0=(nW\u03bcW)nW(N\u2212nWN\u2212\u03bcW)N\u2212nW\n\nif nW > \u03bcW, and L(W)/L0 = 1 otherwise. The window for which the likelihood ratio is maximized identifies the most likely cluster (MLC) [8]. To find the distribution of the log likelihood ratio (LLR) under the null hypothesis, Monte Carlo hypothesis testing [23] is required. p-value of the test is based upon the null distribution of LLR with large number B of Monte Carlo replications of data sets generated under the null hypothesis, i.e.,\n\np^1+\u2211v=1BI(LLRv\u2265LLR\u2217)B+1\n\nwhere LLRv and LLR* is the value of the test statistic for the v-th Monte Carlo replicate and that for the observed data, respectively, and I(\u00b7) is the indicator function.\n\nWe applied the prospective flexible space-time scan statistic to daily syndromic surveillance data in eastern Massachusetts mimicking a real time surveillance system. The data came from an electronic medical record system used by Harvard Vanguard Medical Associates [3,24]. We used the rash and respiratory data during August 1\u201330, 2005. The data are geographically aggregated to ZIP codes. The number of ZIP codes used were different for each syndrome, for example cases of the rash were analyzed in 252 ZIP codes and respiratory in 385. Note that for the flexible space-time scan statistic, the ZIP code whose data does not exist, was treated like a ravine. For example, assume that ZIP codes i1 and i2, i2 and i3 are adjacent each other, respectively, but i1 and i3 are not adjacent. If the data of i2 does not exist under the situation, then it is assumed that i1 and i3 are not directly connected.\n\nBased on the prior daily data for over a year in MA, the expected number of cases were calculated as the predicted means from a generalized linear mixed model (GLMM) as developed by Kleinman et al, adjusted for seasonal effect, day of week, etc, these are the same expectations used in the actual real time surveillance system [25]. We set K = 20 as the maximum length of the geographical window, and the maximum temporal length to be T = 7 days. The number of replications for the Monte Carlo procedure was set to B = 999. In disease outbreak detection, the recurrence interval (RI) is often used as an alternative to the p-value [14]. The measure reflects how often a cluster will be observed by chance, assuming that analyzes are repeated on a regular basis with a periodicity equal to the period of the study. For daily surveillance such as this analysis, the p-value of 0.001 corresponds to the RI of 1,000 days, i.e., 2.7 years, and an alpha level of 0.0027 corresponds to one expected false alarm every year.\n\nThe results of analysis during August 1\u201330 by the flexible and the cylindrical space-time scan statistics are given in Tables 1, 2 and Figure 1. The tables show results for the days with p < 0.0054, which corresponds to the RI of at least 6 months. When looking at rash outbreaks (Table 1), both tests detected the same cluster with a single ZIP code 01951 on August 7, with the same temporal length (6 days) and the same RI (2.7 years). Note that the clusters detected by both tests from August 8 to 10 are not signals of an outbreak because the number of cases on August 8 must be 0, and on August 9 and 10, the number of cases of the cluster was decreasing. For respiratory syndrome (Table 2), each test detected a different cluster with the same RI of 2.7 years on August 12. The cluster detected by the flexible scan statistic contained 12 ZIP codes, while that from the cylindrical scan statistic contained 18 ZIP codes, with 11 ZIP codes detected in common. On August 13 and 14, the flexible scan statistic detected significant clusters with larger RIs, 333 days and 250 days respectively, while the cylindrical scan statistic detected clusters with short RIs, 91 days and 30 days respectively. The flexible scan statistic also detected a cluster on August 15 (RI = 1.4 years) with a temporal length of 6 days, while the cylindrical scan statistic detected a cluster with a temporal length of 5 days (RI = 200 days). For the 6 days from August 12 to 17 (results on August 16 and 17 are not shown in Table 2 because of shorter RIs), the cylindrical scan statistic kept detecting the same cluster, while the flexible scan statistic detected a similar but slightly different cluster each day. However, we should acknowledge the similar lack of evidence in Table 2 for a continued outbreak on August 13 to 14, because the number of additional cases on those days is very close to the expected number of additional cases. On the other hand, there is some evidence for an excess of cases on August 15 (23 additional cases), although the estimated relative risk is substantially reduced.\n\nIn this section, we compare the flexible and cylindrical space-time scan statistics, using benchmark data from 176 New York City ZIP codes ([14,22]). This benchmark data has been described in detail elsewhere [22], and here we only give a brief overview. Based on 2002 numbers, the total population is 8,003,510. The benchmark data sets contain a number of randomly located of cases of a hypothetical disease or syndrome, generated either under the null model with no outbreaks or under one of eight different alternative models with an outbreak in one of four different locations and with either a high or modest excess risk. For each of the null and alternative models, three different sets of data sets were generated, with 31, 32, and 33 days, respectively. For each of the null models, 9,999 random data sets were generated. For each of the alternative models, 1,000 random data sets were generated.\n\nFor each data set, the total number of randomly allocated cases was 100 times the number of days (i.e., 3,100 cases in the data sets containing 31 days). The number 100 was chosen to reflect the occurrence rate of certain syndromes common to the NYC emergency department(ED)-based syndromic surveillance system. Under the null model, each person living in NYC is equally likely to contract the disease, and the time of each case is assigned with equal probability to any given day. Thus, each case was randomly assigned to ZIP code i and day d with probability proportional to \u03bcid = popi, where popi is the population of ZIP code i. For the alternative models, one or more ZIP codes were assigned an increased risk on Day 31 and, when applicable, on Days 32 and 33 as well. For these ZIP code and day combinations, \u03bcid was multiplied by an assigned relative risk. For all other ZIP code and day combinations, \u03bcid did not change. Each case was then randomly assigned with probability proportional to the new set of \u03bcid to generate data under the alternative models.\n\nEight alternative models were evaluated, based on four different outbreak areas of length s* and total population pop* therein, with either high or medium relative risk (RR) [22] (Figure 2).\n\n1. Cluster A: a single ZIP code area in Brooklyn (circular area)\n\ns* = 1, pop* = 85, 089, RR: high = 9.91, medium = 5.66\n\n2. Cluster A5: the same ZIP code with 4 neighboring ZIP codes (non-circular area)\n\ns* = 5, pop* = 318, 754, RR: high = 4.47, medium = 3.06\n\n3. The Rockaways, 5 ZIP codes area (non-circular area)\n\ns* = 5, pop* = 106, 738, RR: high = 8.48, medium = 5.01\n\n4. Hudson River: 20 ZIP codes areas along the shore of the Hudson River (non-circular area)\n\ns* = 20, pop* = 827, 382, RR: high = 2.97, medium = 2.24\n\nA maximum length of the geographic window K = 20 was used for the flexible scan statistic, while the cylindrical scan statistic used a maximum of either K = 20 or a 50 % of the population at risk. A period of T = 3 days was used as the maximum temporal length of the cluster. We did not use the options to include purely temporal clusters (see details in [14]).\n\nFirst of all, we estimated the standard statistical power, which is the probability that the null hypothesis is rejected at the \u03b1 = 0.05 significance level, without considering the overlap between the detected and real clusters. The random data sets generated under the null model were used to get the critical values of the scan statistics. For \u03b1 = 0.05, this is defined as the 500th highest log likelihood ratio when raning those value from all the 9,999 simulated data sets. The estimated power was then calculated is the proportion of the 1,000 random data sets that had a higher log likelihood ratio than the critical value obtained from the null data sets. The results are shown in Table 3. In general, the cylindrical space-time scan statistic has higher power for the three more compact clusters, while the flexible space-time scan statistic have higher power for the long and narrow the Hudson River cluster. On Day 33 of the high excess risk outbreaks, both methods have very high power.\n\nWe can consider two types of spatial misclassifications when applying the cluster detection test (CDT). One is a false negative test result (FN) in which the CDT misses a region included in the true cluster. Sensitivity is 1 - FN rate. The other is a false positive test result (FP) in which the CDT incorrectly detects a region that is not present in the true cluster. The numbers of FNs and FPs for geographical detection are s* - s and l - s, respectively.\n\nThe extended power is based on the bivariate distribution P0(l, s | s*) and penalties introduced for the FPs and FNs of the geographical detection as\n\n(8)I(w\u2212,w+)=\u2211l\u22651\u2211s\u22650W(l,s;w\u2212,w+)P0(l,s|s\u2217)\n\nwhere W(l, s; w-, w+) is a weight function such that\n\n(9)W(l,s;w\u2212,w+)={(1\u2212min\u2061{w\u2212(s\u2217\u2212s),1})(1\u2212min\u2061{w+(l\u2212s),1}),(s\u2264l;0\u2264s\u2264s\u2217,1\u2264l),0,(otherwise)\n\nand w- and w+ are the predefined penalties for the FNs and FPs (per region), respectively. This power includes the following three special powers:\n\n1. The standard power as I(0, 0).\n\n2. The power to detect the geographical true cluster accurately as I(1, 1).\n\n3. The power for which the MLC includes all the regions within the true cluster as I(1, 0).\n\nTakahashi and Tango [26] also proposed the profile of the extended power as\n\n(10)Q(r | s*) = I(1/s*, r/s*),     (0 \u2264 r \u2264 1)\n\nwhere r = w+/w- with w- = 1/s*, because it is difficult to set the value of w- and w+ in advance. Figure 3 shows the plots of the profile Q(r | s*) against r (0 \u2264 r \u2264 1) for flexible and cylindrical scan statistics applied to (a) the cluster A5 and (b) the Rockaways, both on Day 33 with high risk, based upon Tables 5 and 6. Figure 3(a) shows the flexible scan statistic has higher extended power when r = 0 i.e. penalties for the FP w+ = 0, I(1/5, 0) = 0.978 for the flexible and 0.954 for the cylindrical, while the extended power of cylindrical scan statistic is higher for large r, as I(1/5, 1/5) = 0.765 for the flexible and 0.862 for the cylindrical. On the other hand, Figure 3(b) shows the flexible scan statistic is more uniformly powerful than the cylindrical one for the Rockaways cluster, I(1/5, 0) = 0.958 and I(1/5, 1/5) = 0.913 for the flexible, and I(1/5, 0) = 0.885 and I(1/5, 1/5) = 0.872 for the cylindrical, respectively.\n\nAs other measures of accuracy of cluster detection tests, we shall consider sensitivity and positive predictive value [27,28]. These measures can be defined in terms of either the number of regions or the population. First, we define sensitivity of cluster detection tests as the probability of detecting the regions that actually constitute the cluster, i.e, proportion of the number of regions correctly detected from the true cluster, s/s*. We shall present the expected value:\n\n(11)TP1=E[Ss\u2217]=\u2211s=0s\u2217ss\u2217P0(+,s|s\u2217).\n\nPositive predictive value (PPV) of cluster detection tests is defined in a similar manner as the proportion of the number of true regions in the detected cluster, i.e, s/l under l > 0, and the expected value is presented:\n\n(12)PP1=E[SL|L>0]=\u2211l\u22651\u2211s\u22650slP0(l,s|s\u2217)P0(+,+|s\u2217)\n\nBased upon the population, we can define the following sensitivity TP2 and positive predictive value PP2:\n\n(13)TP2=E(Total population of the detected S true regions)Total population of the s\u2217 reigons of true cluster\n\n(14)PP2=E(Total population of S true regionsTotal population of L detected regions|L>0)\n\nAll these summary measures are better the larger they are with 100 being the optimal.\n\nTable 7 shows the sensitivity and PPV of the flexible and cylindrical space-time scan statistics for each cluster with a high relative risk. For cluster A, the cylindrical scan statistic has higher PPV and higher sensitivity than the flexible one. For cluster A5 and the cylindrical has higher PPV on all days and higher sensitivity on day 31, but the flexible scan statistic has higher sensitivity on days 32 and 33. The same is true for the Rockaway cluster. For the Hudson River cluster, the flexible scan statistic has higher PPV than the cylindrical. The flexible scan has higher sensitivity than for the cylindrical with the same upper constant K = 20 on the number of regions in the detected cluster, but lower sensitivity compared to the cylindrical scan with a 50% upper limit on the cluster size. Note though, that this difference in sensitivity is less than the difference in PPV that goes the other way.\n\nIn this paper, we have proposed a flexible space-time scan statistic to detect arbitrarily shaped disease outbreaks. We have also presented a tri-variate power distribution which is useful for evaluating the performance of cluster detection tests, informing us about the spatial and temporal accuracy of the detected clusters in addition to the standard statistical power.\n\nFor the benchmark data evaluated in this paper, the cylindrical scan statistic performs better for the small single zip-code cluster, although by the third day of the outbreak both methods are almost perfect. For the small irregular shaped clusters, A5 and Rockaways, the cylindrical performs better on the first day of the outbreak, but as more data accumulates, the flexible scan statistic has certain advantages in determining the precise size and shape of the outbreak. For the large and narrow Hudson River cluster, the flexible scan statistic performs better than the cylindrical one, with slightly higher standard power, much higher PPV and slightly higher or lower sensitivity depending on the type of cylindrical method used. Results may be different for other types of regular and irregularly shaped disease outbreaks, but the four examples used in this paper gives some sense of the proposed methods performance.\n\nFor early detection, timeliness is much more important than geographical accuracy. When monitoring an occurring outbreak, on the other hand, geographical accuracy becomes critical and is then the key objective since we already know the outbreak is there. Our results suggest that we may use both the cylindrical and flexible scan statistic for disease outbreak detection, but for different purposes. Specifically, for detecting new outbreak that, one may want to use the cylindrical scan statistic. That is especially if we expect the outbreak to start locally, within a reasonably small and compact area containing only a few ZIP-codes. On the other hand, once the outbreak has spread to a larger area, and we want to monitor that spread, one may want to use the flexible scan statistic, with its ability to accuratly determine the precise geographical extent of irregular shaped outbreaks. This is especially true ones the outbreak has left its local area of origin.\n\nTo evaluate the performance of space-time scan statistic, we applied the extended power for purely spatial cluster detection test (8), which is defined as the weighted sum of the bivariate power distribution wherein the weight is given by the geometric mean of (1-penalty for the false negatives) and (1-penalty for the false positives), including the standard power as a special case. Also we applied the profile Q(r | s*) proposed by Takahashi and Tango [26]. This plot gave us a detailed description regarding power of cluster detection tests. Needless to say, it is possible to extend it to space-time version if we could consider the penalties for temporal false negatives and false positives, but we leave this problem for future work. Also, for the profile of the extended power, we chose to use a fixed cost of w- = 1/s* for false negatives and a smaller or equal cost for false positives. For more general situations, we could plot the full bivariate extended power function on the unit square.\n\nSimilarly to the flexible spatial scan statistic in the purely spatial situation, the flexible space-time scan statistics proposed in this paper has a limitation of cluster size, because of the limitation of the speed of computation. The proposed scan statistic works well for small to moderate sized clusters. Although we set the maximum length of the geographical window to K = 20, this is not large enough to detect the 20 ZIP codes of the Hudson River cluster accurately because this cluster is too long to be the subset of the 20-th nearest neighbors of any region. Computation time depends on the size of the data set and K. Indeed, for the August 11 analysis of respiratory syndrome data in Massachusetts, with 385 ZIP codes, a maximum temporal length of T = 7 days, a maximum spatial size of K = 20, and with 999 Monte Carlo replications, the flexible space-time scan statistic took 87.7 minutes to run on a 3.06-GHz Pentium 4 computer, while the cylindrical space-time scan statistic took only 9.8 minutes.\n\nA limitation of length may also prevent the analysis to present large clusters of unlikely and very peculiar shapes. These undesirable properties produced by maximum likelihood ratio might suggest the use of different criterion for model selection, including some penalized likelihood [20,29]. Also, for larger cluster seizes, the method is not practically feasible and a more efficient algorithm is needed.\n\nIn this paper, we considered the right cylinder or right prism of the cluster model, as an expansion of the cylindrical space-time scan statistic for a prospective disease surveillance by Kulldorff [10]. This does not allow the scanning window to adjust itself as the disease outbreak grows or shrinks geographically over time. Recently, Iyengar has suggested using a square pyramid shape window which can model either growth (or shrinkage) and movement of the disease cluster [30]. For the proposed flexible space-time scan statistic, if we could consider the flexibility in both space and time, that is, evaluating all connected subsets within a cylinder instead of W in (4), we can detect more arbitrarily shaped clusters in space-time. For such an expansion, an efficient computational algorithm will be needed for the scanning process, as well as a more sophisticated mechanism for the interpretation of such complicatedly shaped clusters. The implementation and importance of such methods for disease surveillance and monitoring, is an issue for future research.\n\nKT, MK and TT developed the statistical methodology and designed the study. KT, MK and KY analyzed and interpreted the syndromic surveillance data. KT programmed the methods, did the power calculations and wrote the first draft of the manuscript. All authors participated in the interpretation of the results, revised the manuscript, and approved the final version."}