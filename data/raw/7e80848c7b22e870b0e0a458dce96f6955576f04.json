{"title": "The network structure and eco-evolutionary dynamics of CRISPR-induced immune diversification", "body": "antigens that are novel to the host immune system are at a competitive advantage, while those with common ones are at a disadvantage. So far, these studies have only analyzed genetic similarity from the parasite perspective because information on host immunity is typically absent. Hence, how immunity structures host-parasite interactions, for example into modular, or nested topologies, is unknown. Addressing the interplay between the genetic basis of immunity, the structure of the emerging interaction networks and their dynamics, is central to better understand how diversity of hosts and parasites influences infection dynamics and their response to interventions.\n\nGiven the ubiquity of microbes and their infectious viruses for all ecosystems on earth, a critical application of host-parasite networks is to bacteria-phage interactions. An analysis of a large assemblage of bacteria-phage infection networks found that these are predominantly nested rather than modular [16] but a later study suggested that structure depends on phylogenetic scale: modularity at large phylogenetic scales of species interactions and nestedness among interacting strains of the same species [17] . Several hypotheses have been put forward to explain the emergence of modularity and nestedness in bacteria-phage infection networks from immunity-related coevolutionary dynamics [18, 19] . For example, Fortuna et al. [20] have shown that networks of phage and bacteria evolve nestedness under directional arms race dynamics, but not under fluctuating selection. No study has addressed host-virus infection or immunity networks in the context of the explicit underlying molecular mechanisms that link genotype to protection phenotype, limiting our ability to understand and predict when particular structures of emerging networks apply and how they impact the dynamics of the host-parasite system.\n\nMicrobial hosts have developed a range of resistance mechanisms against viruses, the costs and benefits of which depend on the context of the environment and selective pressures induced by the phages [21, 22] . For example, innate immunity can be obtained with restriction-modification systems and adaptive immunity via Clustered Regularly Interspaced Short Palindromic Repeats (CRISPR) and its CRISPR-associated (Cas) proteins [21, 23] . Another prominent mechanism is surface resistance, in which altered receptors prevent viral binding to cell surfaces. Surface resistance evolves rapidly in bacteria in batch liquid culture and has been the focus of virus-host interactions in experimental evolution. [24] . Recent experimental work has investigated tradeoffs between resistance mechanisms in the laboratory. Chevallereau et al. [25] compared tradeoffs between surface resistance and CRISPR, showing that high bacterial mutation rates result in a reduction in the evolution of CRISPR resistance, and in a concomitant increase in resistance via surface mutations. Similarly, Gurney et al. [26] showed using a mathematical model that\n\nThe CRISPR system functions as an adaptive immune system by incorporating DNA segments called 'protospacers' of infecting viruses into host genomes as 'spacers' that constitute sequencespecific immunity and memory [29] . From this perspective, strain diversification of both hosts and pathogens emerges from their frequency-dependent co-evolutionary dynamics, and involves the large combinatorics of spacers and protospacers. Previous work has shown the possibility of diverse populations, containing many strains, with distributed immunity of the host, whose dynamics can exhibit two alternating major regimes, escape and diversification of the viruses and dominance of the microbial host, respectively [38] . We extended the model to allow for larger host and virus richness, and to track the coevolutionary history of both hosts and viruses through time (Methods) . The timing of the switching between the two regimes (which is an emergent property of the model) is defined and identified here based on the dynamics of virus abundance (Methods).\n\nIn the 'virus-diversification regime' (VDR), virus strains proliferate and diversify while in the 'hostcontrolled regime' (HCR) host strains are able to constrain virus diversification and lead to their extinction ( Fig. 1) . During the former, viruses and hosts coexist with fluctuating abundances, whereas during the latter, hosts reach carrying capacity and viruses exhibit declining abundances and richness followed by either escape or extinction (Figs. S3, S4, S5). Due to the stochastic nature of our simulations, the number of alternations between regimes varies. Nonetheless, for our set of parameters, the long-term dynamics of the system consists of complete virus extinction during one of the HCRs (see below and in Discussion for faster mutation rates). In most simulations (\u2248 70%), viruses do not go rapidly extinct and exhibit instead one or more transient periods of diversification ( Fig. 1) , whereas in the rest, they show rapid extinction as hosts exert immediate control. Our analyses concentrate on the alternating transient dynamics that precede extinction.\n\nVariation in viral or host abundance alone cannot drive the transitions between these two regimes, as these do not exist in the corresponding Lotka-Volterra dynamics under neutral conditions of hosts not acquiring specific immunity (SI D,E). An alternative explanation is that the structure of strain diversity, emerging from the eco-evolutionary dynamics via specific immunity, explains the transitions between these dynamical regimes. To investigate the structure of diversity in this complex system, we consider two complementary bipartite networks, the 'immunity' and 'infection' graphs, through time. In these networks a node represents a strain of a virus (unique combination of protospacers) or a host (unique combination of spacers), and edges represent a given 5 . CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint Virus diversification implies a temporary escape from host control and their rise in abundance, which in turn increases encounters with hosts. The resulting rise in per-capita infection rates of hosts leads to their concomitant diversification because new host strains are generated by acquiring at least one new protospacer. Therefore, despite an initial decline in the abundance of hosts', their richness typically rebuilds (Fig. S3) .\n\ntype of interaction, either infection or protection from infection ( Fig. S6 ).\n\nAt the start of the simulations and during VDRs, the infection network is built over time (by addition of host and virus strains) developing a modular structure in which infections are concentrated within modules of viruses and hosts, with more edges within than between these groups ( Fig. 2A, Fig. S7 ).These modules reflect different niches (hosts as resources) for virus growth. As proposed by the strain theory for multilocus antigen pathogens [13, 39, 40] , this niche structure arises in part from frequency-dependent competition among viruses for hosts. Specifically, viruses with rare escape mutations in protospacers to which hosts have not yet gained immunity exhibit a competitive advantage over those with abundant protospacers. Viruses with common protospacers are in turn at a disadvantage. The resulting frequency-dependent selection drives viruses to have little overlap in the hosts they can infect, and in so doing creates a modular structure which enables their coexistence and therefore their increasing diversity. The creation of niches is linked to the structured genetic diversity of the hosts, which is apparent in the also modular host-spacer network in which modules delineate groups of hosts that share immunity via the same spacers (Fig. S8 ).\n\nThe importance of immune selection in the formation of these niches can be demonstrated by asking whether clonal expansion alone could account for the modularity of the infection network.\n\nThis is not the case, as shown by randomizations of structure that reorder strains according to phylogenetic relationships, in which the modules are lost (Fig. S9) . Moreover, in the absence of frequency-dependent selection and associated host memory, diversification of the viruses and coexistence of different strains is not observed. This is demonstrated by a neutral model in which all the processes of the full system are retained except for the specific memory of the host (SI E).\n\nIn contrast to strain theory [12, 15] , here the persistence of the modular structure in the infection network and the coexistence of a diverse community of viral strains is only transitory. The number of susceptible hosts available to all viruses declines very rapidly, so that no virus is able to infect all hosts. Interactions become organized into the modular structure, with hosts within a module becoming rapidly unavailable for viruses by either lysis or acquisition of protection. This closing of niches coupled with the inability of the viruses to escape makes the VDR effectively transient.\n\nTo understand why virus escape becomes highly unlikely, we turn next to the structure of the protection network.\n\nDiversification of viruses, enabled by the modular structure of the infection network, increasingly diversifies the host population (Fig. S5) . In other words, escape from host control via mutation of protospacers allows higher abundances of particular virus strains, which therefore also experience 7 . CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint Fig. S6 . Each network is a snapshot of the population, with time steps depicted above the networks corresponding to those marked in Fig. 3 . Numbers in the x and y axes indicate the number of viruses and hosts participating in each of the networks. Because the size of the matrix is limited, the width and height of the networks are not necessarily proportional to the number of strains (e.g. a reduced number of strains results in panels with larger squares). The purple and green lines depict the initiation of a virus-dominated and host-controlled regimes (VDR and HCR), respectively. a, Modularity in the infection network. Colored interactions fall inside modules of virus strains that infect similar hosts (each module has a different color). Black interactions are those that fall outside all modules. The size of the network and the number of modules increase during the VDR (between purple and green vertical lines) and decline during the HCR (right of the green vertical line). b, Weighted nestedness in immunity networks. Colors of interactions depict the number of matches between viruses and hosts. The network has a weighted-nested structure, which enforces an orderly viral extinction. Nestedness builds up during the VDR and declines during the HCR, as viruses go extinct. The extinction is orderly, with viruses to which many hosts has immunity via many spacers (those at the left), going extinct first.\n\nhigher encounter rates with hosts in general, leading to the acquisition of new spacers (through either the failure of their previous immunity or infection by an escape mutant) (see details on the model in Methods). Such red-queen co-evolutionary dynamics progressively adds spacers to hosts during the VDR, building the immunity network (Fig. 2B) . In this network, edges indicate at least one spacer-protospacer match, and the weight of the edge encodes the number of different matches, protecting a given host from a given virus (Fig. S6C) . By definition, a lack of an edge indicates infection, and an edge value larger than one indicates redundancy in immunity.\n\nWe find that this redundancy has a characteristic quantitative nested structure. We can order the network such that hosts with immunity to most viruses also have more matches to those viruses, and subsequent hosts (from top to bottom) are immune to subsets of viruses, via fewer matches ( Fig. S6G, Fig. 2B ). Similarly, each virus strain (from left to right) can infect a progressively smaller subset than the virus following it, also via fewer matches. The weighted nested structure is assembled by a complex interplay of temporal changes in abundances, associated encounter rates and selection pressures, in which host and viral age play an important role. How the matrix structure is woven from bottom to top, and left to right, with the respective addition of new hosts and viruses, is reflected in the relationship between the order of the rows and columns and strain age (Fig. S10 ). It is also the result of CRISPR failure, which allows infection and the acquisition of additional spacers.\n\nThe nested pattern in the redundancy of immunity, built during a VDR, enforces order and predictability in virus extinctions during the subsequent HCR. Viruses for which most hosts have acquired immunity via multiple matches will tend to go extinct earlier than those with fewer matches (Fig. 2B, Fig. S11 ). Somewhat paradoxically, this orderly extinction will facilitate in turn a new viral escape and the stochastic initiation of another virus expansion cycle, as it reduces nestedness by preferentially removing viruses with a high number of matches. Hence, resistance to phages declines at the population level, rather than at the individual host level. Specifically, the extinction process reduces the competition for hosts between viruses to which hosts have either no match (0-match) or a single match (1-match) (Fig. 3B ) and therefore also increases their relative abundance in the populations. An increase in the proportion of 1-matches raises the effective mutation rate of the remaining viral population (SI C). Because viral escapes are associated with a particular tripartite structure in which hosts are immune to viruses via a single match (Fig. S12 ), the increase in the frequency of viral strains with potential to escape is crucial for the ability to initiate a new VDR.\n\nEpidemiologically, these two processes, viral growth rate and potential escape, can be captured via two modified measures of the basic reproductive number [41] (see SI B,C). The first, R 0 j (t), is the number of offspring produced at time t by the virus strain j from infecting all hosts with no protection to it (0-matches). The second, R 1 j (t), is the number of offspring that a virus strain j would produce by escaping protection from hosts via a single mutation (1-match) at time t. These two components can be added to obtain the 'potential reproductive number' of a virus strain j, R pot j (t) = R 0 j (t) + R 1 j (t), which quantifies the contribution of a viral strain and its potential progeny to the population growth, conditional on escape.\n\nDuring HCRs, the contribution of the second component R 1 j can raise R pot j above the critical 9 . CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint Time % matches . Although the mean R 1 j is always < 1 (pink), R pot can be > 1. During these times, depicted with red points, a mutation would allow the viral population to grow. d, Even when R pot > 1 in the HCR, an escape is likely only when the mutation hits an abundant virus. The plot shows the viral abundance corresponding to high values of R pot . Specifically, this abundance is obtained by thresholding the distribution of R pot values across the simulation (shown in the inset) at its 90% quantile (dashed vertical line), and summing the abundance of all viruses whose reproductive number exceeds this threshold. Approaching the end of the HCR, high values of R pot j (i.e., above the 90% quantile) are concentrated in virus strains that are highly abundant due to the extinction of most other viruses. Because mutations are more likely to occur in highly abundant virus strains, it becomes likely that a mutation hits a virus with a high potential for virus growth, and therefore, escape. Vertical dashed lines indicate the time points for the network snapshots in Fig. 2 . 10 value of R pot j = 1 (Fig. 3C) , indicating a viable escape. Importantly, as a higher proportion of the viral abundance becomes concentrated in strains with the highest R pot j , escape mutations must occur on those viruses that would eventually initiate a new VDR (Fig. 3D ). Towards the end of an HCR, small viral outbreaks are observed of increasing frequency anticipating this critical transition (Fig. 1B) . The small epidemics locally generate some virus diversification which counterbalances extinctions. These opposite effects mean that towards the end of the HCR, nestedness inverts its decline and starts growing again. Extinctions and births of virus strains change both the size of the immunity network and the distribution of protection weights among the links. These two effects are reflected in the nestedness index [42] [43] [44] .\n\nTo ensure the generality of our results given the stochastic nature of the dynamics, we repeated our analysis for 100 simulations. Across these simulations, we find the same characteristic differences between the regimes in dynamics and network structure as in our main example. In particular, VDRs are shorter than HCRs, have higher values of weighted nestedness, have more modules in the infection networks, and have higher values of R 0 j (Fig. S13 ). Together, these results indicate a general pattern of viral diversification via creation of host niches, the corresponding buildup of immunity in VDRs, and the breakdown of weighted nestedness that eventually leads to escape or extinction during HCRs.\n\nWe also examined the effect of a five-fold acceleration in the speed of overall diversification of viruses, still within the general order of magnitude of plausible mutation rates. These \"accelerated\" simulations, which match the parameters used in ref [38] are also characterized by alternating regimes. The general outcome for simulations with higher mutation rates is a final sustained VDR with no virus extinction, preceded by a few HCRs. As expected, they exhibit higher richness of hosts and viruses, and episodes of virus diversification can be longer than for lower mutation rates (Fig. S14 ). Their infection networks are modular and the immunity networks are nested ( Fig. S15) . Although viral richness still declines sharply at the beginning of each HCR, the earlier and faster generation of new strains via small outbreaks maintains a higher richness than before throughout this regime. Thus, nestedness appears more consistent through time. Higher mutation rates also make more apparent a general feature of the dynamics (already present at lower values) that requires further investigation in the future; namely, trends of diversification superimposed on the alternating regimes. Specifically, subsequent HCRs (VDRs) exhibit a higher number of host (viral) strains, culminating in long episodes of fluctuating richness for both players. This temporal but long trend appears to be transient, in the sense that the end of one of the high-richness episodes 11 . CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint re-initiates the alternating regimes at a low diversity of both hosts and viruses (not shown).\n\nFinally, we analyzed three unique empirical data sets. Ideally, one would consider temporal data on host-phage CRISPR matches. Such data are currently unavailable because obtaining it requires hundreds of genotypes of virus and CRISPR alleles to be resolved. Metagenomic datasets [31] can obtain such diversity but do not link spacers to individual host strains. Hence, currently available temporal data are either resolved at the strain level but for very low diversity [25, 32] or contain many spacers and protospacers but without host-phage CRISPR matches between multiple strains [31] . In fact, even for non-temporal data, there are very few examples of virus and host populations sufficiently resolved at an individual strain level. We considered here three such static data sets, and asked whether they exhibit evidence for the immunity structure predicted by the theory.\n\nWe had previously established such profiles of diversity in naturally occurring microbial populations [27, 34, 45] but had not tested their structure in relation to immunity and infection networks.\n\nWe use empirical data from three data sets in which both CRISPR alleles and virus strains have been carefully and manually assembled [27, 34] . These represent lytic, chronic and temperate virus lifestyles and two different microorganisms from the two domains of life where CRISPR occurs (archaea and bacteria). The first two data sets compare genomes resolved to individual strains of the thermoacidophilic crenarchaeon Sulfolobus islandicus sampled at a single time point from two different locations. The third data set is from the gamma proteobacteria Pseudomonas aeruginosa [27] , isolated from the sputum of CF patients in a high resolution longitudinal dataset collected by Marvig et al. [46] , with virus genomes obtained from the mu-like viruses from the genomic database because these are the most highly targeted temperate phage genomes in P. aeruginosa. From each data set, the empirical immunity matrices were constructed by comparing CRISPR arrays from each individual host strain to virus genomes. Because we did not have a time series, we assessed the statistical significance of nestedness for each empirical network by comparing the observed value of its nestedness index (for two different indices, Methods) to a distribution obtained from 10,000 shuffled networks. We find that the probability that a shuffled network will be more nested than the observed one is effectively nil (i.e., p-value< 0.0001; one-tailed test) in all three empirical networks ( Fig. 4, Fig. S16 ). In light of our theoretical results, these findings suggest that in these three systems hosts control populations of viruses via distributed immunity that is redundant in the number of matches. Moreover, we find that, as in our theoretical results, the empirical hostspacer networks are also modular (Fig. S16) , suggesting that the mechanism by which immunity 12 . CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It The matrices depict the number of shared spacers and protospacers between hosts (rows) and viruses (columns). Each network is ordered by column and row sums and is nested in the quantity of matrix cells. The networks come from 3 different systems: a, Sulfolobus islandicus hosts from a single location in Yellowstone National Park compared to contemporary lytic SIRV viruses isolated from Yellowstone National Park. b, S. islandicus hosts compared to contemporary chronic SSV viruses from the Mutnovsky Volcano in Russia, 2010. (c, Pseudomonas aeruginosa hosts from Copenhagen compared to temperate mu-like viruses. To test the hypothesis that for a given distribution of matches in the population of host strains, the observed network is organized in a non-random, weighted-nested pattern, we shuffled networks by randomly distributing the interactions.\n\nis obtained is similar to the one we describe here.\n\nThe role of resistance (innate and adaptive immunity, surface modification) in driving the diversity, evolution and coevolution of microbes and viruses has been extensively studied [21, 25, 31, [47] [48] [49] [50] [51] .\n\nThe role it plays in structuring microbial populations remains however poorly investigated, despite possible consequences for host-phage coevolution and population stability. Our theoretical results have shown that the eco-evolutionary dynamics of a host-pathogen system with CRISPR-induced resistance can influence, and in turn be influenced by, the network structure of strain diversity. In The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint diversification, the former builds the latter. In turn, weighted nestedness puts an end to pathogen diversification as it implies redundant resistance that virus mutation can no longer overcome. It also contains the seeds of its own unraveling by implying a certain order in viral extinction, and in so doing, creating the conditions for a potential new viral escape. Thus, weighted nestedness of protection networks is at the center of the coevolutionary dynamics and the transient dynamical regimes we have described here. It has not been reported before as the focus of host-virus network studies has been on infection patterns.\n\nModularity has been described for host-parasite infection networks and attributed to a variety of mechanisms such as phylogeny, specificity and co-evolution [9, 52, 53] . It was also detected in a host-virus system, where it was suggested to arise via negative frequency-dependent selection [17] .\n\nIts emergence from immune selection was demonstrated here. It is consistent with existing strain theory developed mostly for human infections and pathogens with multilocus encoding of antigens, when evolution is considered explicitly [11, 12, 15, 54] . Immune selection acts as a form negative frequency-dependent selection creating groups of pathogens with limiting overlap in antigenic space.\n\nIn the absence of data on immunity of hosts, this pattern has been described as modules, or clusters, in networks that depict genetic similarity between the pathogens themselves [11, 12] . This outcome is conceptually analogous to groups of species or microbes coexisting under frequency-dependent competition for resources [55] . We are able to consider here the immune genotype of pathogens and hosts simultaneously, which allows us to move beyond pathogen genetic similarity to consider actual infection patterns. One major difference with previous strain theory is that modularity and associated coexistence in our model are only transient and not accompanied by stable or metastable population dynamics. Future work should examine whether this difference and the associated shifts in dynamical regimes arise from the heritable nature of CRISPR-based immunity, which by definition cannot produce fully susceptible offspring, needed to sustain transmission. Host-phage coexistence can also result from loss of immunity [50] , a feature absent from our model which could prolong VDRs by supplying a constant inflow of susceptible hosts.\n\nThe arms race between a single host and a single phage can terminate if a host strain gains spacers for which phages cannot generate mutations. Indeed, there is evidence for possible selection towards obtaining specific spacers [56] . When multiple hosts are involved, the higher the strain diversity, the more difficult it is for the virus to escape via point-mutations [32] . We show that, when multiple viruses are involved, beyond immune diversity per se, its structure is a key factor in providing resistance. Specifically, weighted nestedness provides a population-level mechanism by 14 .\n\nCC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint which hosts can control viral populations. It remains an open question whether it can arise under non-CRISPR immunity or non-heritable immunity.\n\nFor CRISPR-induced immunity, nestedness reflects the co-evolutionary diversification of hosts in response to that of viruses, and more specifically, the resulting redundancy of immune memory, to normalize weighted nestedness (sensu [44] ), so that effects of its change can be isolated for network size and distributed redundancy of protection.\n\nTransience of alternating dynamical regimes in the CRISPR system is not an impediment to the formation of rich structures by co-evolution; it is here its natural consequence. It should be recognized, however, that the alternation of dynamical regimes occurs in the model in a defined region of parameter space that allows for high diversification, and is absent in many earlier simulations (e.g. [38] ). Because host-control periods lead to stochastic viral extinction, identifying the conditions in terms of critical parameter combinations that give rise to these dynamics is of practical importance.\n\nFuture theory should more broadly investigate the dynamics-structure nexus over parameter space, in particular for protospacer mutation rates and spacer acquisition probabilities, which set the pace of evolution and have already been recognized as key to the outcome of viral extinction [32, 38, 57] . Protospacer number should also be critical as the mutation rate per protospacer ultimately sets the speed of diversification and co-evolution. Although higher numbers should be examined for more realistic complexity, we expect our results to hold and provide a valuable point of reference.\n\nAnother direction is consideration of anti-CRISPR mechanisms. Recent studies show that viruses maintain anti-CRISPR proteins that target (sometimes incompletely) CRISPR activity [58, 59] . At the virus population level, viruses can \"cooperate\" in a way that initial infections block the hosts' CRISPR systems, facilitating subsequent infections, which can result in phage epidemics [60] . The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint of CRISPR-based and surface-based resistance should be explored under different conditions, a complex direction requiring better empirical understanding of the trade-offs involved [25] .\n\nThe demonstration of significant weighted nestedness in the empirical networks suggests that coevolution involving CRISPR-induced immunity is at play in natural microbial populations. It further suggests the applicability of our modeling results to predict these kinds of transitions.\n\nObtaining time series data on CRISPR-mediated interactions between multiple host and virus strains should be a priority to further test our theoretical results. Ultimately, knowledge on the stability of diverse host and viral populations can be applied to control of microbes in food and industrial sciences, infectious disease emergence and treatment with phage therapy, microbiome dynamics, agriculture, and environmental engineering.\n\nThe model implements the formulation by Childs et al. [30] , which combines three main components: ecological population dynamics, stochastic co-evolution generating diversity, and molecular identity of hosts and viruses defining CRISPR immunity. Diversification events (spacer acquisition by the host and protospacer mutation of viruses) are modeled stochastically, whereas population dynamics of different sub-populations (i.e., strains) of hosts and viruses are represented deterministically with Lotka-Volterra differential equations (eqns. 1,2).\n\nEach strain of host i and virus j is defined by a unique genomic state of their spacer and protospacer sets S i and G j , respectively. In the ecological population dynamics, each host strain i has abundance N i (the carrying capacity of all strains is K) and reproduces at a per-capita rate of r. Each viral strain j has abundance V j , which increases due to infection and lysis of hosts and decays at a density-independent rate m. Extinction of any host or viral strain occurs when these fall below a critical threshold \u03c1 c . Viruses infect at a constant 'adsorption rate' \u03c6 either hosts that do not have protection or those whose protection fails (see below).\n\n. CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint Host immunity to a virus is defined in the molecular component of the model and is based on genomic sequence matches between the spacer and protospacer sets. Specifically, CRISPR immunity is defined using the function M ij = M (S i , G j ), which equals 1 if there is at least 1 match between the sets: |S i \u2229 G j | \u2265 1, or 0 otherwise. The CRISPR immune mechanism is not perfect and can fail.\n\nWhen M ij = 1, there is a probability p that the host strain is lysed and correspondingly, 1 \u2212 p that it survives and the virus is eliminated. On the other hand, when M ij = 0, there is a probability q that the virus strain is eliminated, resulting in the acquisition of a protospacer by the host, and 1 \u2212 q that it is lysed by the virus. Both p and q are small (p, q 1).\n\nThe above Lotka-Volterra dynamics are implemented in between any two stochastic events We numerically implemented the model in C++ to increase computational efficiency. This enables consideration of a larger number of spacers/protospacers, and hence host and virus richness, for longer simulation times, than in the original MATLAB code [30] ). Our implementation combines: (1) a Gillespie algorithm to determine the time between two stochastic events and to randomly select a virus/host strain to mutate a protospacer/acquire a new spacer, and (2) a numerical ODE solver using Euler's method. The code includes the following features to facilitate subsequent network (and other) analyses: (1) all data related to virus or host strains (e.g., identity of protospacers/spacers, abundance values) at each time are written to files during simulation; (2) the parent ID of each newly generated virus or host strain is tracked to generate phylogenetic trees;\n\n(3) a checkpoint implementation for running longer simulations. Details on the implementation are in Supplementary Information.\n\nWe used the parameters summarized in Table S1 based on [30, 38] . Host growth rate corresponds to a doubling time of an hour within the range of observed values for P. aeruginosa (20 mins) and\n\n17 . CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint Sulfolobus (8 hrs). The adsorption rate also falls within typical range values of 10 \u22128 to 10 \u22129 ml min \u22121 . The order of magnitude of our mutation rate is consistent with standard mutation rates for DNA based organisms, if we assume that mutation at a single site enables protospacer escape from a spacer match. The burst size of 50 is on the low side with values of 200 observed in P. aeruginosa. This is motivated by a lower protospacer number than currently documented in nature. Specifically, the speed of virus escape ultimately depends on the effective rate of mutation per protospacer, which increases linearly with the product of burst size and the mutation rate parameter \u00b5 and decreases inversely with the number of protospacers. Therefore, our parameter set should generate similar speeds of protospacer evolution than for higher burst sizes and also higher numbers of protospacers (e.g. \u03b2 = 200 and N p \u00d7 4). Our numerical implementation allows consideration of a higher number of protospacers than before; for simplicity, in our study we used a number of protospacers that is still below those typically observed but have compensated with a lower value of offspring produced (burst size; see SI.)\n\nOur general approach to define regimes was to classify each point in the virus abundance time series to either a HCR or a VDR. We did so by detecting changes in relative virus abundance, defined as the total virus abundance at any given time t, V T (t), divided by the maximum abundance in whole time series, V T : A(t) = V T (t)/max(V T ). Using relative abundance allows for comparisons and analysis across multiple simulations; considering absolute abundance does not change the regime definition (Fig. S17) . A HCR is a sequence of points in which V T (t) changes very little, which can be captured by calculating the changes between consecutive time points. We consider the first\n\n. Values close to 0 in A would occur when (1) there is no, or low, change in A between two consecutive time intervals so that A' itself is small in each of these periods; or (2) A varies and changes sign in these consecutive intervals but the size of these changes 'up' and 'down' are small, as well as the peak in A this reflects. (We ignore here the case of an almost linear increase, which does not apply).\n\nWe classified each point as belonging to the HCR if the absolute value of A is smaller than a given small threshold, so that |A t | < 0.001, and to a VDR otherwise. This procedure creates a sequence of points C(t) with each point classified into HCR or VDR (Fig. S17) . We added two further conditions. The first one includes time points in the HCR when isolated increases in virus abundance are not recognized as sufficiently small peaks by our threshold, but these increases are 18 . CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint localized outbreaks in the sense of not esulting in a complete escape and a regime switch. To include such events within the HCR we calculated a threshold f defined as the 75% quantile value of the distribution of VDR lengths in C. Any sequence of VDR points shorter than f was converted to the HCR. The last condition for classification to a HCR was that a sequence of points had to be longer than the longest-lasting virus outbreak.\n\nWhile the values for the thresholds we have used may seem, to some degree, arbitrary, this would be the case for any other algorithm for classification because a 'regime' is not naturally defined by the dynamical system, but rather detected in the emerging time series. As an independent corroboration for our method, we imposed the regime boundaries calculated using virus abundance time series to time series of host abundance and virus diversification. The regimes are evident in those time series as well (e.g., Fig. S3 ). For example, in the virus diversification time series, the rate of diversification is much steeper in the VDR than in the HCR (Fig. S5 ). This additional verification increases the confidence we have in our ability to classify these regimes.\n\nThe networks we use are bipartite networks, which contain two sets of nodes (e.g., hosts and spacers or hosts and viruses). Bipartite networks are mathematically represented using incidence matrices.\n\nA graphical overview of the networks (and associated matrices) and how we constructed them can be found in Fig. S6 . Here, we provide details on network construction.\n\nNetworks of genetic composition At each time t, we defined a host-spacer network, S(t) (and associated matrix S xi (t)) as a bipartite network in which each edge is drawn between a host strain i and a spacer x (Fig. S6A,E) . We analogously defined a virus-protospacer network P(t) (and associated matrix P yj (t)) as a bipartite network in which each edge is drawn between a virus strain j and a protospacer y (Fig. S6B,F) . Hence, in each network a host or virus strain's genome is the set of its neighboring spacer or protospacer nodes, respectively.\n\nImmunity network We used S(t) and P(t) to define an immunity network at a time t, I(t) (and associated matrix I ij (t)) in which edges are drawn between a virus strain j and a host strain i.\n\nEdge weights were defined as the number of matching spacers and protospacers between S(t) and P(t) for any given host-virus pair (Fig. S6 . That is:\n\n, where M has a value of 1 if spacer x in the spacer set of host i, S i , is the same as protospacer y in the protospacer set of virus j, G j and 0 otherwise.\n\nN ij (t)) as a subset of the immunity network in which I ij (t) = 0 (Fig. S6D,H) . That is, edges in N ij (t) were drawn between hosts and viruses that did not have an edge in I. We weighted the edges of N ij (t) by a normalized measure of encounter between virus strain j will and a host i, based on their abundance values:\n\nwhere V j (t) and N i (t) are the abundances of a virus strain j and a host strain i at time t and N T is the total abundance of hosts.\n\nWeighted nestedness We evaluated the nestedness of I ij (t) using WNODF [43] . Briefly, the index ranges from 0 to 100, with the maximum 100 representing perfect nestedness. Perfect nestedness occurs when all 2x2 sub-matrices of the form\n\nsatisfy the conditions for host b 1 to be immune to the two viruses via more matches than b 2 (a > c, b > d, a > d) and for v 2 to have less matches to the two hosts than v 1 (a > b, c > d). We calculated WNODF with the networklevel function in the bipartite package (version 2.11) in R.\n\nWe calculated WNODF when at least 2 strains of both hosts and viruses were present.\n\nIn empirical data we evaluated nestedness in two ways. First, we used WNODF. Second, we calculated the largest eigenvalue of I ij (t)I T ij (t), \u03c1, as suggested by [61] . We did not use \u03c1 in the simulations because preliminary analyses indicated that this measure is highly dependent on network size and therefore cannot be used to compare between networks. However, it is suitable for comparing an observed network to its shuffled counterparts because for a given distribution of weights an network size high values of \u03c1 indicate a more quantitatively nested structure [61] .\n\nWNODF and \u03c1 are the only two measures for quantitative nestedness we are aware of. WNODF cannot handle networks which are fully connected (i.e., density of 1) and we therefore did not use it for our Yellowstone data set (Fig. S16A ).\n\n. CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint Community detection To find 'communities', or as commonly referred to, 'modules', we used the Map Equation objective function to calculate the optimal partition of the network [62, 63] .\n\nInfomap), which calculates network partitioning based on the movement of a random walker on the network (see for details). In any given partition of the network, the random walker moves across nodes in proportion to the direction and weight of the edges. Hence, it will tend to stay longer in dense areas representing groups of, for example, viruses and hosts with high interaction density. These areas can be defined as 'modules'. The time spent in each module can be converted to an information-theoretic currency using an objective function called the Map equation and the 'best' network partition corresponds is the one that minimizes the Map Equation [62, 63] . For convenience we use the term 'modules', as it is commonly used to refer partitions of networks across different disciplines, but Infomap does not calculate a modularity function (sensu [64] ). We chose the map equation over the more commonly used modularity objective function because of the computational efficiency of its implementation (Infomap) [65] , given that we needed to analyze hundreds of thousands of networks.\n\nOur networks were bipartite and the modules we detect contain both sets of nodes. The input to Infomap was an edge list of the original bipartite network (as was done in other bipartite implementations of Infomap; [66] ). Specifically, we ran Infomap using: Infomap filename -N 20 --tree -2 --seed 123 -i link-list. Note that a unipartite representation of the same bipartite network obtained by using a block matrix-for example, using S 0 0 S T for the host-spacer network-would generate the same results.\n\nWe derived two modified measures of the basic reproductive number (see derivation in SI). The first, R 0 j (t), is the number of offspring produced at time t by virus strain j from infecting all hosts with no protection to it (0-matches) and is defined as:\n\nThe delta-function M The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint protection from hosts via a single mutation (1-match) at time t and is defined as:\n\nHere, M 1 ij equals 1 (and 0 otherwise) when there is exactly 1 matching spacer-protospacer pair in the set of spacers of host i, S i and the set of protospacers of virus j, G j . g j is the length of the protospacer cassette of virus j and quantifies the probability that a mutation will hit a particular protospacer. Adding these two quantitites together we obtain the 'potential reproductive number' of a virus strain j, which quantifies the contribution of a viral strain and its potential progeny to population growth, conditional on escape:\n\nEmpirical data\n\nThe first data set represents a single time point from three adjacent hot springs (NL01, NL10\n\nand NL13) in the Nymph Lake region of Yellowstone National Park. These three springs have shown to share a single well-mixed population of S. islandicus hosts [67] . Viruses were collected from contemporary populations and CRISPR spacers and virus isolates suggest that these are viruses extracted from NCBI to substitute for a lack of sequenced contemporary viruses [27, 46] .\n\nWe shuffled the matrices of the empirical data by randomly distributing the interactions (function The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint that the for a given distribution of matches the observed network is non-randomly structured in a quantitatively nested way.\n\nWe thank Whitney England and Matthew Pauly for data processing and collection, and Qixin He for The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint\n\nWe used a Gillespie algorithm to introduce stochasticity in spacer acquisition and protospacer mutation. The Gillespie algorithm was originally conceived for chemical reactions [69] and is now widely used in epidemiology and ecology (e.g. [11, 14, 15, 30] ). The basic algorithm consists of three steps: (1) determination of the random time to the next reaction (also termed 'event'); (2) random selection of a specific event from a set of events using weighted sampling (events with higher rates are more likely to be chosen); and (3) updating the number of chemical molecules (in our case, host or virus strains) involved in the selected event. Mathematically, consider N stochastic events with corresponding rates a 1 , a 2 , . . . , a N . The random time to an event is given by t event = 1 a ln( 1 r )), where a = N i=1 a i and r is a random number uniformly distributed in the range [0, 1). A specific event is selected with probabilities proportional to its rate, and the corresponding state numbers concerning this event are updated.\n\nIn the CRISPR coevolutionary model, we consider two stochastic events: spacer acquisition and protospacer mutation. To apply the Gillespie algorithm, we first calculate the spacer acquisition rates for all host strains and the mutation rates for all protospacers in all virus strains. We use these rates to then determine the time to the next stochastic event, to select a virus or host strain for the given change, and to add the newly generated host (in case of spacer acquisition) or virus (in case of a mutation event) strain to the system. Mathematically, the spacer acquisition rate for host strain i is a i = q\u03c6 j N i V j and the protospacer mutation rate for protospacer y of virus strain j is\n\nThe random time to the next stochastic event is t event = 1 a ln( 1 r )) where a = i a i + j y \u00b5 jy and r is a random number uniformly distributed in the range [0, 1). With probability i a i a , this process randomly selects a specific host to acquire a spacer from a random virus strain (with probabilities proportional to their spacer acquistion rates). Otherwise, this process randomly selects a specific protospacer in a specific virus strain to be mutated (with probabilities proportional to their mutation rates), generating a new virus strain.\n\nThis simulation scheme adopts the deterministic treatment of population dynamics in between stochastic events, and follows the protocol proposed in [30] , where more details can be found.\n\nAlthough, in principle, population dynamics could also be implemented stochastically [57] , this 31 . CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint approach would have been more time-consuming given the large numbers of viruses and host strains.\n\nWe derive here the general expression for the basic reproductive number (R 0 ) of the system. The growth rate of a virus strain j is given by:\n\nwhere M (S i , G j ), or more simply M ij , is the number of matches between the set of spacers of bacteria i and the set of protospacers of virus j.\n\nThe condition for the spread of this virus strain\n\nBy assuming that \u03c6 ij = \u03c6 is constant and the same for all strains,\n\nThen,\n\nWith the total abundance of bacteria N T = i N i ,\n\n32 . CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint Thus,\n\nWe can call the first term of equation S1 the effective R 0 , or R 0 ef f , resulting from feasible infections of bacteria that do not have immunity to the given virus. The second term can be neglected since the probability of CRISPR failure p 1.\n\nC Potential R 0 resulting from an escape mutation\n\nWe define the potential reproductive number of a virus as the number of offspring it would produce from a single escape mutation. For this, we need to consider the contribution to this number from infections of bacteria that are protected by a single match, R 0 1 . We let g j denote the number of protospacers per strain and write\n\nThen,\n\nwhere M 1 ij is 1 only when there is a single match between the pair of virus j and bacteria i, and 1 g j is the probability that the mutation falls on a particular protospacer of virus j.\n\nThe simplest model whose dynamics can be compared to those of the full model corresponds to the mean-field differential equations describing the bacteria-virus interactions when the structure of who is protected from whom is randomized. That is, in this model, the emergent structure of the protection matrix is randomized, and the immunity matrix is reduced to a fixed density of edges immunity. Starting from the full model from Childs et al.,\n\nand simplifying some notation, we hav\u0117\n\nWe assume that the entries of the immunity matrix M ij (defined by the matches between the set of spacers (S i ) of the host i and the set of protospacers (G j ) of the virus j) take a constant value in time, M \u2261 M ij . We further rewrite the system for the total abundance of virus V and bacteria N as the following general predator-prey system:\n\n. CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint\n\n, we can rewrite the system as:\n\nThe above two-dimensional system ( S3 and S4) has 3 equilibrium points C i = (N * , V * ):\n\n\u2022 The trivial point C 1 = (0, 0).\n\n\u2022 The point where hosts have reached their carrying capacity and the viruses have gone extinct,\n\n\u2022 The positive coexistence point defined by the intersection of the nullclines of the system\n\nThese nullclines are both a function of M and are given by:\n\nThe local (asymptotic) stability of these equilibria can be determined based on the Jacobian matrix of the system :\n\nTogether the expressions for the nullclines and for the Jacobian show that the location of the equilibria in phase space and their local stability depend on M and therefore, on M = M ij . The change in the equilibria as a function of M is illustrated in Figure S1 . These dynamics can be compared to those of the full system for the aggregated abundance of all viruses and hosts S2.\n\n. CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint E Neutral model without explicit immunity (Randomization of the immunity matrix) By construction, the above mean-field simplification of the system does not explicitly include the diversity of hosts and viruses. To determine the importance of both specific immune memory and the structure associated with it, we consider here a neutral model in which the ability to the system to generate diversity is not affected (that is, both the mutation of viruses and the acquisition of spacers by the bacteria are still included) but the specificity of immune memory is removed. We specifically randomize every \u2206t the matches M (S i , G j ) between the protospacers set of viruses (G j ) and the spacers set in hosts (S i ). For every virus-host strain pair, we randomize their match by choosing a random number r and comparing it with the average density of the immunity network, \u03c1.\n\nWe define the density of a an infection network at time t as C = E/vn, where E is the total number of infection interactions and v and n represent the number of virus and host strains, respectively.\n\nThe average density is then the average of C across all time points. Then, we establish a match for this pair if r < \u03c1. This preserves the average density of matches but randomizes their identity. Under this null model, the system shows neither the regime of virus diversification (VDR) nor that of host dominance (BDR) (results not shown). This comparison to the full model established that the structure of specific immunity generated by the CRISPR system is necessary to create the observed dynamics of the full model.\n\nCopenhagen, Denmark and a global set of temperate and lytic P. aeruginosa viruses extracted from NCBI to substitute for a lack of sequenced contemporary viruses [27, 45, 46] . Viruses were grouped based on nucleotide similarity into families known as clusters, and these clusters were assigned a number identifiers which have been described in a previous study (4) . In this study we only used viruses from cluster 3 to avoid a false positive result in which we obtain a nested structure due to immune patterns that depend on the cluster (phylogeny).\n\nIllumina sequenced reads from samples were quality filtered using prinseq with the following arguments: -derep 1245 -lc method entropy -lc threshold 50 -trim qual right 30 -trim qual left 30 -trim qual type min -trim qual rule lt -trim qual window 5 -trim qual step 1 -trim tail left 5 -trim tail right 5 -min len 66 -min qual mean 30 -ns max p 1 -verbose. Spacers were extracted from quality filtered sequencing reads using an in-house bioinformatic pipeline (in preparation, code available upon request). These scripts utilize known repeats from S. islandicus and P. aeruginosa and BLASTn to extract spacers from reads located between any repeats. BLASTn cutoffs for repeats against reads were based on an e-value of 0.001 with the -task blastn-short argument. After spacer extraction, spacers are grouped based on a hamming distance cutoff by comparing spacers as strings of nucleotides and using a sliding window across each string of basepairs (in preparation, code available upon request). We define unique spacers that have 100% nucleotide identity to one another, using a hamming distance of 0 between nucleotide sequences. Unmatched overhanging base pairs between spacers were considered mismatches since these are likely independently acquired spacers from sequential protospacers with different PAM sequences. Unique spacers were mapped to strains in order to determine the spacer set per strain. Sulfolobus islandicus isolates in Nymph Lake contained on average 256 spacers per strain ranging from 62 to 520 spacers. Sulfolobus islandicus isolates from Kamchatka contained on average 181 spacers per strain ranging from 20 to 795 spacers. P. aeruginosa isolates contained 34 spacers on average with a range of 4 to 64 spacers. P. aeruginosa, Nymph Lake S. islandicus, and Mutnovsky S. islandicus isolates contained 40, 40 and 50 total alleles respectively.\n\nSpacer matches to protospacers were initially found using BLASTn with a -task blastn-short argument, with an e-value minimum of 0.01. The P. aeruginosa database contained 6,231,702 total bp, with 98 viral genomes ranging from 3,588 bp to 309,208 bp. The SSV BLASTn database contained 34 genomes containing 514,147 total bases with the longest sequence being 18,548 bp and the shortest being 11,323 [27, 34] . The SIRV BLASTn database was composed of 10 genomes containing 347,896 total bases with the longest sequence being 32,308 bp and the shortest being 32,308.\n\n. CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint Table S1 Description and values of model parameters used in simulations, following [30] , except for a higher numbers of spacers and protospacers. Protospacer BLAST matches were extended to 3 base pairs longer than the length of the spacer and retrieved with blastdbcmd tool from the blast+ package to retrieve the PAM sequences [70, 71] . Gaps found between alignments were added to these extended protospacer matches. Gaps, or insertion/deletion events, were considered as mismatch when comparing along the entire length of the aligned protospacer and spacer.\n\nWe analyzed our data with two criteria. The first criterion was a perfect match with zero mismatches between the entire length of the aligned spacer and protospacer (100% alignment) and The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint HCR VDR Extinction Fig. S2 Phase portrait of the full system for total abundances of hosts and viruses. The dynamics of the full system differ from those of the two-dimensional mean-field ODE as expected from the transitions from coexistence (during the VDR) and the host dominance at carrying capacity (during the HCR) (top panel). During the VDR, the system's trajectory spirals around a moving coexistence point, closest to the fixed points C 3 for increasing M (color points). During the HCR, the system is close to the degenerate sink, collapsing onto C 2 after virus extinction. These different parts of the dynamics become more evident when including time explicitly in the phase portrait (bottom panel).\n\n. CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint Fig. S4 Host phylogenetic tree. The tree is not inferred, but rather drawn based on exact genealogical data (which strains descends from which) collected during the simulation. Branch length indicates the lifetime of any given host strain. Hosts diversify and go extinct primarily during VDRs, resulting in strain replacement but strains can also persist from one VDR to the next.\n\n. CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. The matrix is organized by the sum of columns and rows and is quantitatively nested. This is the matrix we use in Fig. 2B . h The counterpart matrix for the network in D. The two interactions correspond to the empty matches in g. This is the matrix we use in Fig. 2A .\n\n. CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint\n\nFig. S10 Host and virus rankings in the weighted nested immunity matrix as a function of age. The plots show node strength (sum of the corresponding number of matches in the immunity network) of hosts (top) and viruses (bottom) against their age measured from the time of their birth, for two selected times before the start of an HCR (left, t=231 and right, t=1720). Each data point represents a host (top) or virus (bottom) strain. On the different plots, selected groups of youngest and oldest strains are indicated. The oldest host strains occupy the lower rows (low node strength), and their rankings tend to decrease with age. This is because descendants of a given host inherit all of its spacers and add a new one, which always results in an increase in total matches (host node strength). Because they have acquired additional protection, they can grow in abundance and through resulting enhanced encounters and infections, the failure of existing spacers can add redundancy (more than one spacer to the same virus), further contributing to their ranking. The oldest viruses occupy the leftmost columns, with the highest column sums of matches to hosts, since longer lifetimes provide the opportunity for many encounters, and therefore for both the failure of existing spacers (which adds redundancy to a given entry) and the addition of new spacers (which distributes immunity throughout entries). A successful offspring will have mutated a protospacer that confers escape from a given match of the parent; thus, successful descendants exhibit one less match and are placed to the right. It is worth noting that there is considerable variation around the general trends with age, reflecting the complex interplay of the stochastic acquisition of spacers and protospacers with the abundance dynamics which affect both encounter and mutation rates.\n\n. CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It Immunity rank of extinct viruses count Fig. S11 Order of extinctions. We tested for \"orderly\" extinctions in which extinction preferentially happens from the viruses to which hosts have most immunity to those that can infect many hosts. For any virus that went extinct we calculated an 'immunity rank'. Specifically, for a given time step, we calculated the strength of all n virus nodes in the immunity network, s = (s 1 , s 2 , . . . , s j , . . . , s n ), where s j is the node strength of virus j (i.e., the sum of the columns in Fig 2B) . Viruses with higher values of s j are those that are more to the left in Fig 2B, and to which hosts have high immunity. We removed duplicate values in s (to avoid ties) and ordered it in ascending order to obtain s . We then calculated the relative position of s j in s . A rank of 1 means that the virus that went extinct was highly ranked (e.g., position 5 out of 5 values will render a rank of 1). 50% of viruses (median indicated by a vertical dashed line) had an extinction rank of 0.5.\n\n. CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint a Regimes length: VDRs are shorter than HCRs. b Nestedness is higher during VDRs than HCRs. c The basic reproductive number is higher during HCRs, indicating that virus reproduction is higher. During HCRs the basic reproductive number is generally small than one (dashed vertical line). d The infection network has more modules during VDRs due to virus diversification. In all plots the average was first taken for each regime type (VDR or HCR) within each simulation. Then, these averages were plotted as a distribution of 100 simulations. VDRs and HCRs are in purple and green, respectively.\n\n. CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It Pseudomonas aeruginosa hosts from Copenhagen compared to temperate mu-like viruses (bottom). Panels a, b and c are host-spacer networks in which interactions within host-spacer modules are colored (as in Fig. S8A ). Panels c, d and e are distributions of either the leading eigenvalue (\u03c1), or WNODF of 10,000 immunity networks shuffled by randomly distributing interactions. Value of the observed \u03c1 or WNODF is depicted with a vertical dashed line. We did not calculate WNODF in the Yellowstone data set because this index cannot handle networks which are completely full (i.e., with a density of 1).\n\n. CC-BY-NC-ND 4.0 International license is made available under a The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It The copyright holder for this preprint (which was not peer-reviewed) is the author/funder. It . https://doi.org/10.1101/850800 doi: bioRxiv preprint"}